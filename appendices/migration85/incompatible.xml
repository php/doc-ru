<?xml version="1.0" encoding="utf-8"?>
<!-- EN-Revision: 87d781c7710702181b0d0669cf2c4d0f5c9d3037 Maintainer: sergey Status: ready -->
<!-- Reviewed: no -->
<sect1 xml:id="migration85.incompatible" xmlns:xlink="http://www.w3.org/1999/xlink">
 <title>Изменения, которые ломают обратную совместимость</title>

 <sect2 xml:id="migration85.incompatible.core">
  <title>Ядро PHP</title>

  <sect3 xml:id="migration85.incompatible.core.array-callable-alias">
   <title>Псевдонимы <literal>"array"</literal> и <literal>"callable"</literal></title>

   <simpara>
    Больше нельзя использовать <literal>"array"</literal> и <literal>"callable"</literal>
    в качестве имён псевдонимов классов в <function>class_alias</function>.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.loosely-comparing-object">
   <title>Свободное сравнение несравнимых объектов</title>

   <simpara>
    Ранее свободное сравнение несравнимых объектов
    (например, перечислений, <classname>CurlHandle</classname> и других внутренних классов)
    с логическими значениями было несогласованным.
    При сравнении с логическим литералом <code>$object == true</code> происходило
    приведение типа <code>(bool)$object</code>.
    При сравнении со статически неизвестным значением <code>$object == $true</code>
    всегда возвращалось значение &false;.
    Поведение было унифицировано, теперь всегда происходит приведение типа <code>(bool)$object</code>.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.gc-collect-cycles">
   <title>Возвращаемое значение gc_collect_cycles</title>

   <simpara>
    Возвращаемое значение <function>gc_collect_cycles</function> больше не включает строки и ресурсы,
    которые были косвенно собраны через циклы.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.substitute-final-subclasses">
   <title>Замена ключевого слова static в окончательных подклассе</title>

   <simpara>
    Теперь разрешается заменять ключевое слово <type>static</type>
    на <type>self</type> или конкретное имя класса в окончательных (final) подклассах.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.tick-handlers">
   <title>Обработчики тиков</title>

   <simpara>
    Обработчики тиков теперь деактивируются после выполнения всех функций
    завершения работы, деструкторов и очистки обработчиков вывода.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.trait-binding">
   <title>Связывание трейтов</title>

   <simpara>
    Теперь трейты связываются до родительского класса.
    Небольшое изменение в поведении, которое больше соответствует ожиданиям пользователей.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.errors-compilation-and-linking">
   <title>Ошибки при компиляции и связывании классов</title>

   <simpara>
    Ошибки, возникающие во время компиляции и связывания классов,
    теперь всегда откладываются и обрабатываются после компиляции или связывания классов.
    Фатальные ошибки, возникающие во время компиляции или связывания классов,
    приводят к немедленной обработке всех отложенных ошибок
    без вызова пользовательских обработчиков ошибок.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.exception-by-userdefined-handler">
   <title>Исключения, выбрасываемые пользовательским обработчиком ошибок</title>

   <simpara>
    Исключения, выбрасываемые пользовательскими обработчиками ошибок при обработке
    ошибок связывания классов, больше не повышаются до уровня фатальных ошибок
    и не препятствуют связыванию.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.attribute-during-compilation">
   <title>Ошибка применения атрибута во время компиляции</title>

   <simpara>
    Применение <code>#[\Attribute]</code> к абстрактному классу, перечислению, интерфейсу или трейту
    вызывает ошибку во время компиляции. Ранее атрибут можно было добавить,
    но при вызове метода <methodname>ReflectionAttribute::newInstance</methodname> выдавалась ошибка.
    Ошибку можно отложить с момента компиляции до момента выполнения с помощью нового атрибута
    <code>#[\DelayedTargetValidation]</code>.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.disable-ini-setting">
   <title>INI-настройка disable_classes</title>

   <simpara>
    INI-настройка <link linkend="ini.disable-classes">disable_classes</link> удалена,
    так как приводила к нарушению различных допущений движка.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.destruct-non-array-values">
   <title>Деструктуризация значений, не являющихся массивами</title>

   <simpara>
    Деструктуризация значений, не являющихся массивами (кроме &null;),
    с помощью <literal>[]</literal> или функции <function>list</function>
    теперь выдаёт предупреждение.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.warning-related-to-cast">
   <title>Предупреждения, связанные с приведением типов</title>

   <simpara>
    Теперь при преобразовании чисел с плавающей точкой (или строк, похожих на числа с плавающей точкой)
    в целые числа выдаётся предупреждение, если их невозможно представить в виде целого числа.
    Это касается явных и неявных преобразований в целые числа.
   </simpara>

   <simpara>
    Теперь при преобразовании NAN в другие типы выдаётся предупреждение.
   </simpara>

  </sect3>

 </sect2>

 <sect2 xml:id="migration85.incompatible.bzip2">
  <title>Модуль Bzip2</title>

  <simpara>
   Функция <function>bzcompress</function> теперь выбрасывает ошибку <classname>ValueError</classname>,
   если значение параметра <parameter>$block_size</parameter> вне диапазона от 1 до 9.
  </simpara>

  <simpara>
   Функция <function>bzcompress</function> теперь выбрасывает ошибку <classname>ValueError</classname>,
   если значение параметра <parameter>$work_factor</parameter> вне диапазона от 0 до 250.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.dom">
  <title>DOM</title>

  <simpara>
   Клонирование <classname>DOMNamedNodeMap</classname>,
   <classname>DOMNodeList</classname>, <classname>Dom\NamedNodeMap</classname>,
   <classname>Dom\NodeList</classname>, <classname>Dom\HTMLCollection</classname>
   и <classname>Dom\DtdNamedNodeMap</classname> теперь выбрасывает ошибку.
   Такое поведение никогда не приводило к созданию рабочего объекта,
   поэтому никаких последствий не ожидается.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.fileinfo">
  <title>Модуль FileInfo</title>

  <simpara>
   Функция <function>finfo_file</function> и метод <methodname>finfo::file</methodname>
   теперь выбрасывают ошибку <exceptionname>ValueError</exceptionname> вместо
   <exceptionname>TypeError</exceptionname>, если значение параметра <parameter>$filename</parameter>
   содержит нулевые байты.
   Теперь тип выбрасываемой ошибки соответствует остальной частью языка.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.intl">
  <title>Модуль интернационализации</title>

  <simpara>
   Для работы модуля теперь требуется как минимум ICU 57.1.
  </simpara>

  <simpara>
   Метод <methodname>IntlDateFormatter::setTimeZone</methodname> и функция <function>datefmt_set_timezone</function>
   теперь выбрасывают исключение <exceptionname>IntlException</exceptionname>
   при неинициализированных классах или ошибках клонирования.
  </simpara>

  <simpara>
   Все методы класса <classname>Locale</classname> теперь выбрасывают исключение
   <exceptionname>ValueError</exceptionname>, если значение параметра locale содержит нулевые байты.
  </simpara>

  <simpara>
   Поведение константы <constant>Collator::SORT_REGULAR</constant> при обработке числовых строк
   теперь соответствует поведению <constant>SORT_REGULAR</constant> в модуле ext/standard.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.ldap">
  <title>Модуль LDAP</title>

  <simpara>
   Функция <function>ldap_get_option</function> и <function>ldap_set_option</function>
   теперь выбрасывают исключение <exceptionname>ValueError</exceptionname> при передаче недопустимого параметра.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.mbstring">
  <title>Модуль MBString</title>

  <simpara>
   Таблицы данных Unicode были обновлены до версии Unicode 17.0.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.mysqli">
  <title>Модуль MySQLi</title>

  <simpara>
   Вызов конструктора mysqli для уже созданного объекта
   теперь невозможен и выбрасывает ошибку <exceptionname>Error</exceptionname>.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.odbc">
  <title>Модуль ODBC</title>

  <simpara>
   ODBC теперь предполагает, что доступна как минимум функциональность ODBC 3.5.
   Определение ODBCVER и флаги системы сборки, управляющие им, были удалены.
  </simpara>

  <simpara>
   ODBC больше не имеет флагов сборки для сборки с конкретными драйверами (за исключением DB2)
   и удаляет особые случаи для этих драйверов.
   Настоятельно рекомендуется использовать диспетчер драйверов,
   такой как iODBC или unixODBC, на операционных системах кроме Windows.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.opcache">
  <title>Модуль Opcache</title>

  <simpara>
   Модуль Opcache теперь всегда встроен в бинарный файл PHP и всегда загружается.
   INI-директивы <link linkend="ini.opcache.enable">opcache.enable</link> и <link linkend="ini.opcache.enable-cli">opcache.enable_cli</link>
   по-прежнему работают.
  </simpara>

  <simpara>
   Флаги конфигурации <option role="configure">--enable-opcache</option>/<option role="configure">--disable-opcache</option>
   были удалены и сборка больше не создаёт объекты <filename>opcache.so</filename> или <filename>php_opcache.dll</filename>.
  </simpara>

  <simpara>
   Использование INI-директив <literal>zend_extension=opcache.so</literal> или
   <literal>zend_extension=php_opcache.dll</literal> выдаст предупреждение.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.pcntl">
  <title>Модуль PCNTL</title>

  <simpara>
   Функция <function>pcntl_exec</function> теперь выбрасывает ошибку <exceptionname>ValueError</exceptionname>,
   если элементы параметра <parameter>$args</parameter> содержат нулевые байты..
  </simpara>

  <simpara>
   Функция <function>pcntl_exec</function> теперь выбрасывает ошибку <exceptionname>ValueError</exceptionname>,
   если записи или ключи параметра <parameter>$env_vars</parameter>
   содержат нулевые байты.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.pcre">
  <title>Модуль PCRE</title>

  <simpara>
   Модуль скомпилирован без полу-устаревшего параметра
   компиляции PCRE2_EXTRA_ALLOW_LOOKAROUND_BSK.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.pdo">
  <title>Модуль PDO</title>

  <simpara>
   Аргументы конструктора, заданные в сочетании с
   константой <constant>PDO::FETCH_CLASS</constant>,
   теперь следуют обычной семантике CUFA (<function>call_user_func_array</function>).
   Это означает, что строковые ключи будут действовать как именованные аргументы.
   Кроме того, автоматическая оборачивание аргументов по значению, передаваемых в параметр по ссылке,
   было удалено и теперь выдаётся обычное предупреждение <constant>E_WARNING</constant>.
   Чтобы передать переменную по ссылке в аргумент конструктора, используйте общее
   присвоение ссылки на значение массива: <code>$ctor_args = [&amp;$valByRef]</code>.
  </simpara>

  <simpara>
   Попытка вызова метода <methodname>PDOStatement::setFetchMode</methodname> во время
   вызова <methodname>PDO::fetch</methodname>,
   <methodname>PDO::fetchObject</methodname>,
   <methodname>PDO::fetchAll</methodname>, например, с использованием таких уловок, как
   передача объекта запроса в качестве аргумента конструктора при извлечении в
   объект, теперь будет выбрасывать ошибку <exceptionname>Error</exceptionname>.
  </simpara>

  <simpara>
   Изменились значения констант <constant>PDO::FETCH_GROUP</constant>,
   <constant>PDO::FETCH_UNIQUE</constant>,
   <constant>PDO::FETCH_CLASSTYPE</constant>,
   <constant>PDO::FETCH_PROPS_LATE</constant> и
   <constant>PDO::FETCH_SERIALIZE</constant>.
  </simpara>

  <simpara>
   Теперь выбрасывается исключение <exceptionname>ValueError</exceptionname>, если
   константа <constant>PDO::FETCH_PROPS_LATE</constant> используется с режимом извлечения,
   отличным от <constant>PDO::FETCH_CLASS</constant>,
   в соответствии с другими флагами извлечения.
  </simpara>

  <simpara>
   Теперь выбрасывается исключение <exceptionname>ValueError</exceptionname>,
   если константа <constant>PDO::FETCH_INTO</constant> используется в качестве режима
   извлечения в методе <methodname>PDO::fetchAll</methodname>,
   аналогично <constant>PDO::FETCH_LAZY</constant>.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.pdo-firebird">
  <title>Драйвер PDO_FIREBIRD</title>

  <simpara>
   Теперь при попытке установить слишком длинное имя курсора
   в классе <classname>PDOStatement</classname>, полученном от драйвера Firebird,
   выбрасывается исключение <exceptionname>ValueError</exceptionname>.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.pdo-sqlite">
  <title>Драйвер PDO_SQLITE</title>

  <simpara>
   SQLite <methodname>PDO::quote</methodname> теперь будет выбрасывать исключение
   или выдавать предупреждение, в зависимости от режима ошибок,
   если строка содержит нулевой байт.
  </simpara>

  <simpara>
   Метод <methodname>PDO::sqliteCreateCollation</methodname> теперь выбрасывает исключение,
   если у callback-функции неправильный тип возвращаемого значения,
   что делает его более совместимым
   с поведением метода <methodname>Pdo\Sqlite::createCollation</methodname>.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.posix">
  <title>Модуль POSIX</title>

  <simpara>
   Функция <function>posix_kill</function> теперь выбрасывает
   исключение <exceptionname>ValueError</exceptionname>,
   если аргумент process_id меньше или больше, чем поддерживает платформа
   (целое число со знаком или большой диапазон),
   функция <function>posix_setpgid</function> теперь выбрасывает
   исключение <exceptionname>ValueError</exceptionname>,
   если process_id или process_group_id меньше нуля или больше, чем поддерживает платформа.
  </simpara>

  <simpara>
   Функция <function>posix_setrlimit</function> теперь выбрасывает
   исключение <exceptionname>ValueError</exceptionname>,
   если аргументы hard_limit или soft_limit меньше -1 или если soft_limit больше hard_limit.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.reflection">
  <title>Модуль интроспекции кода Reflection</title>

  <simpara>
   Метод <methodname>ReflectionAttribute::newInstance</methodname> теперь может
   выбрасывать ошибки для внутренних атрибутов, если атрибут был применён к недопустимой цели,
   а ошибка была отложена с момента компиляции до момента выполнения
   с помощью атрибута #[\DelayedTargetValidation].
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.session">
  <title>Модуль Session</title>

  <simpara>
   Попытка записать данные сессии, где ключ <varname>$_SESSION</varname> содержит
   символ вертикальной черты (<literal>|</literal>),
   теперь будет выдавать предупреждение вместо молчаливой ошибки.
  </simpara>

  <simpara>
   Функция <function>session_start</function> более строго относится к аргументу options.
   Теперь функция выбрасывает ошибку <exceptionname>ValueError</exceptionname>,
   если массив не является хеш-картой, или ошибку <exceptionname>TypeError</exceptionname>,
   если значение read_and_close не является допустимым типом, совместимым с int.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.simplexml">
  <title>Модуль SimpleXML</title>

  <simpara>
   Передача выражения XPath, которое возвращает что-либо,
   кроме набора узлов, в методе <methodname>SimpleXMLElement::xpath</methodname>
   теперь выдаёт предупреждение и возвращает значение &false;,
   вместо того, чтобы молчаливо завершаться с ошибкой и возвращать пустой массив.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.snmp">
  <title>Модуль SNMP</title>

  <simpara>
   Функции <function>snmpget</function>,
   <function>snmpset</function>,
   <function>snmp2_get</function>,
   <function>snmp2_set</function>,
   <function>snmp3_get</function>,
   <function>snmp3_set</function>
   и <methodname>SNMP::__construct</methodname> теперь выбрасывают ошибку
   <exceptionname>ValueError</exceptionname>, если имя хоста
   слишком большое, содержит нулевые байты или если порт указан
   с отрицательным значением или больше 65535, а значения времени ожидания и повторных попыток
   меньше -1 или слишком большое.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.soap">
  <title>Модуль SOAP</title>

  <simpara>
   Метод <methodname>SoapClient::__doRequest</methodname> теперь принимает
   новый необязательный параметр <parameter>$uriParserClass</parameter>,
   который принимает строковые аргументы или &null;.
   Значение &null; представляет исходный метод (<function>parse_url</function>),
   а новые обработчики будут использоваться при передаче
   либо <classname>Uri\Rfc3986\Uri</classname>, либо <classname>Uri\WhatWg\Url</classname>.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.sockets">
  <title>Модуль Sockets</title>

  <simpara>
   Функции <function>socket_create_listen</function>, <function>socket_bind</function> и <function>socket_sendto</function>
   теперь выбрасывают ошибку <exceptionname>ValueError</exceptionname>,
   если порт меньше 0 или больше 65535,
   а также если любой из элементов массива <parameter>$hints</parameter> имеет числовой индекс.
  </simpara>

  <simpara>
   Функция <function>socket_addrinfo_lookup</function> теперь выбрасывает
   ошибку <exceptionname>TypeError</exceptionname>,
   если какое-либо из значений <parameter>$hints</parameter> не может быть преобразовано в целое число,
   и может выбросить ошибку <exceptionname>ValueError</exceptionname>,
   если какое-либо из этих значений переполняется.
  </simpara>

  <simpara>
   Функция <function>socket_set_option</function> с опциями
   <constant>MCAST_LEAVE_GROUP</constant>/<constant>MCAST_LEAVE_SOURCE_GROUP</constant>
   теперь выбрасывает исключение, если значение не является корректным объектом или массивом.
  </simpara>

  <simpara>
   Функция <function>socket_set_option</function> с контекстом многоадресной рассылки
   теперь выбрасывает ошибку <exceptionname>ValueError</exceptionname>,
   если созданный сокет не принадлежит семейству
   <constant>AF_INET</constant>/<constant>AF_INET6</constant>.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.spl">
  <title>Модуль SPL</title>

  <simpara>
   Класс <classname>ArrayObject</classname> больше не принимает перечисления,
   так как изменение свойств <property>$name</property> или <property>$value</property>
   может нарушить допущения движка.
  </simpara>

  <simpara>
   Параметр <parameter>$length</parameter> метода <methodname>SplFileObject::fwrite</methodname>
   теперь может принимать значение &null;.
   Значение по умолчанию изменено с <literal>0</literal> на &null;.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.standard">
  <title>Стандартные модули</title>

  <simpara>
   Использование функции семейства printf с форматером,
   в котором ранее не была указана точность, приводило к некорректной
   переустановке точности вместо того, чтобы рассматривать ее как точность 0.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.tidy">
  <title>Модуль Tidy</title>

  <simpara>
   Методы <methodname>tidy::__construct</methodname>, <methodname>tidy::parseFile</methodname>,
   <methodname>tidy::parseString</methodname> теперь выбрасывают ошибку <exceptionname>ValueError</exceptionname>,
   если конфигурация содержит некорректное значение или пытается установить внутреннюю запись,
   доступную только для чтения, и ошибку <exceptionname>TypeError</exceptionname>,
   если ключ конфигурации не является строкой.
  </simpara>

 </sect2>

</sect1>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
