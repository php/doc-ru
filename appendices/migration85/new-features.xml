<?xml version="1.0" encoding="utf-8"?>
<!-- EN-Revision: ce397343296708654c8cdac774e23a9ee47ab27d Maintainer: sergey Status: ready -->
<!-- Reviewed: no -->
<sect1 xml:id="migration85.new-features" xmlns:xlink="http://www.w3.org/1999/xlink">
 <title>Новая функциональность</title>

 <sect2 xml:id="migration85.new-features.core">
  <title>Ядро PHP</title>

  <sect3 xml:id="migration85.new-features.core.pipe-operator">
   <title>Оператор Pipe</title>

   <simpara>
    Добавили оператор конвейеризации <link linkend="language.operators.functional"><literal>|&gt;</literal></link>.
   </simpara>

   <informalexample>
    <programlisting role="php">
<![CDATA[
<?php

$result = "Hello World" |> strlen(...);
print $result . PHP_EOL;  // Prints "11"
]]>
    </programlisting>
   </informalexample>
  </sect3>

  <sect3 xml:id="migration85.new-features.core.closures-in-constexpr">
   <title>Замыкания в константных выражениях</title>

   <para>
    Добавили поддержку статических замыканий в константных выражениях. Константные выражения теперь поддерживают
    как стандартный синтаксис объявления анонимных функций,
    так и синтаксис с многоточием, которым создаются
    <link linkend="functions.first_class_callable_syntax">первоклассные вызываемые объекты</link>
    <link linkend="class.closure">Closure</link>. Статические замыкания определяют при инициализации:

    <simplelist>
     <member>Параметров атрибутов.</member>
     <member>Значений по умолчанию для свойств и параметров.</member>
     <member>Глобальных констант, констант в пространствах имён и констант классов.</member>
    </simplelist>
   </para>
  </sect3>

  <sect3 xml:id="migration85.new-features.core.nodiscard-attribute">
   <title>Атрибут #[\NoDiscard]</title>

   <simpara>
    Добавили атрибут <classname>NoDiscard</classname>, который делает
    значение возврата функции обязательным для обработки.
   </simpara>

   <simpara>
    Добавили также инструкцию <literal>(void)</literal>, которая указывает на намеренное
    игнорирование требования обработать значение возврата.
    Инструкция <literal>(void)</literal> не влияет на выполнение программы,
    а только подавляет предупреждения,
    которые выдаёт атрибут <code>#[\NoDiscard]</code>, и возможные
    диагностические сообщения, которые выдают внешние IDE или инструменты статического анализа.
   </simpara>

   <informalexample>
    <programlisting role="php">
<![CDATA[
<?php

#[\NoDiscard]
function concat(string $a, string $b): string {
     return $a . $b;
}

// Предупреждение: Значение, которое возвращает функция concat(), требуется либо обработать,
// либо намеренно проигнорировать путём приведения к типу (void) в xxx.php.
concat("a", "b");

// Предупреждение не выдаётся, поскольку возвращаемое значение присваивается переменной.
$results = concat("a", "b");

// Предупреждение не выдаётся, поскольку инструкция (void) намеренно подавила вывод предупреждения.
(void)concat("a", "b");
]]>
    </programlisting>
   </informalexample>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.attributes-on-constants">
   <title>Атрибуты констант</title>

   <simpara>
    Добавили поддержку нацеливания атрибутов на константы, которые объявляются вне классов выражениями наподобие
    <code>const MY_CONST = 1;</code> и вычисляются на этапе компиляции.
    Константы, которые определили функцией — <code>define('MY_CONST', 1);</code>, не поддерживают назначение атрибутов.
   </simpara>

   <simpara>
    Атрибут <classname>Deprecated</classname> теперь поддерживает нацеливание на константы.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.delayedtargetvalidation-attribute">
   <title>Атрибут <code>#[\DelayedTargetValidation]</code></title>

   <simpara>
    Новый атрибут <classname>DelayedTargetValidation</classname>
    подавляет ошибки, которые на этапе компиляции выдаёт ядро или модуль
    при назначении атрибутов недопустимым целям.
    При назначении атрибута ядро или модуль сообщают об ошибках во время выполнения
    в момент вызова метода <methodname>ReflectionAttribute::newInstance</methodname>.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.override-for-properties">
   <title>Атрибут <code>#[\Override]</code> для свойств</title>

   <simpara>
    Атрибут <classname>Override</classname> теперь поддерживает нацеливание на свойства.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.static-aviz">
   <title>Асимметричная видимость статических свойств</title>

   <simpara>
    Добавили поддержку <link linkend="language.oop5.visibility-members-aviz">асимметричной видимости</link>
    при объявлении статических свойств.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.backtraces-for-fatal-errors">
   <title>Трассировки стека вызовов при фатальных ошибках</title>

   <simpara>
    Фатальные ошибки наподобие превышения предельного времени выполнения
    теперь включают трассировку стека вызовов.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.final-property-promotion">
   <title>Объявление окончательных свойств в конструкторе</title>

   <simpara>
    Конструкторы теперь поддерживают объявление окончательных свойств
    <link linkend="language.oop5.decon.constructor.promotion">при продвижении параметров до свойств класса</link>.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.casts-in-constexpr">
   <title>Приведения типов в константных выражениях</title>

   <simpara>
    Добавили поддержку приведения типов в константных выражениях.
   </simpara>

   <informalexample>
    <programlisting role="php">
<![CDATA[
<?php

const T1 = (int) 0.3; // Раньше: "Fatal error: Constant expression contains invalid operations"
print T1 . PHP_EOL;   // Теперь выводит "0"
]]>
    </programlisting>
   </informalexample>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.clone-function">
   <title>Функция clone</title>

   <simpara>
    Языковая конструкция <link linkend="language.oop5.cloning">clone</link>
    теперь стала функцией и поддерживает переназначение доступных только для чтения свойств
    во время клонирования через новый параметр <property>$withProperties</property>.
   </simpara>

  </sect3>

 </sect2>

 <sect2 xml:id="migration85.new-features.curl">
  <title>Модуль cURL</title>

  <simpara>
   Добавили поддержку <link linkend="class.curlsharepersistenthandle">общих дескрипторов</link>,
   которые сохраняются между PHP-запросами, разделяют ресурсы между сеансами обмена данными
   и сокращают накладные расходы на повторную установку соединений.
  </simpara>

  <simpara>
   Для функции <function>curl_getinfo</function> добавили поддержку констант
   <constant>CURLINFO_USED_PROXY</constant> (требуется библиотека libcurl >= 8.7.0),
   <constant>CURLINFO_HTTPAUTH_USED</constant> и <constant>CURLINFO_PROXYAUTH_USED</constant> (libcurl >= 8.12.0).
   При возврате функцией <function>curl_getinfo</function> массива та же информация доступна
   в элементах с ключами <literal>"used_proxy"</literal>,
   <literal>"httpauth_used"</literal> и <literal>"proxyauth_used"</literal>.
   Константа <constant>CURLINFO_USED_PROXY</constant> получает значение ноль,
   если предыдущая передача выполнялась не через прокси, или ненулевое значение, если передача выполнялась через прокси.
   Константы <constant>CURLINFO_HTTPAUTH_USED</constant> и <constant>CURLINFO_PROXYAUTH_USED</constant>
   получают битовые маски, которые указывают на методы аутентификации HTTP и прокси
   в предыдущем запросе.
   Возможные значения содержатся в описании констант семейства <constant>CURLAUTH_<replaceable>*</replaceable></constant>.
  </simpara>

  <simpara>
   Добавили cURL-опцию <constant>CURLOPT_INFILESIZE_LARGE</constant> —
   безопасная замена константы <constant>CURLOPT_INFILESIZE</constant>.
   В отдельных системах опция <constant>CURLOPT_INFILESIZE</constant> для размера файла принимает только
   32-разрядное знаковое целочисленное значение, которое ограничивает предельный размер файла 2,0 ГиБ, даже в 64-разрядных системах.
   Константа <constant>CURLOPT_INFILESIZE_LARGE</constant> принимает наибольшее целочисленное значение,
   обработку которого поддерживает система.
  </simpara>

  <simpara>
   Добавили значения <constant>CURLFOLLOW_OBEYCODE</constant>, <constant>CURLFOLLOW_FIRSTONLY</constant>
   и <constant>CURLFOLLOW_ALL</constant> для опции <constant>CURLOPT_FOLLOWLOCATION</constant>
   функции <function>curl_setopt</function>.
   Константа <constant>CURLFOLLOW_OBEYCODE</constant> для более строгого соблюдения перенаправлений, если они разрешены.
   Константа <constant>CURLFOLLOW_FIRSTONLY</constant> следует только за первым перенаправлением,
   поэтому передача прекратится, если в текущем сеансе обмена данными появятся очередные перенаправлениями.
   Константа <constant>CURLFOLLOW_ALL</constant> эквивалентна установке
   константе <constant>CURLOPT_FOLLOWLOCATION</constant> значения true.
  </simpara>

  <simpara>
   Для функции <function>curl_getinfo</function> добавили поддержку
   константы <constant>CURLINFO_CONN_ID</constant> (требуется библиотека libcurl >= 8.2.0).
   Константа возвращает уникальный идентификатор соединения, через которое модуль cURL выполнял передачу данных.
   В первую очередь константа полезна, когда в приложениях на уровне PHP требуется
   логика передачи данных через то же соединение или логика пула соединений.
   При возврате функцией <function>curl_getinfo</function> массива
   значение доступно в элементе с ключом <literal>"conn_id"</literal>.
  </simpara>

  <simpara>
   Для функции <function>curl_getinfo</function> добавили поддержку
   константы <constant>CURLINFO_QUEUE_TIME_T</constant> (требуется библиотека libcurl >= 8.6.0).
   Константа возвращает время в микросекундах,
   которое запрос провёл в очереди соединений библиотеки libcurl перед отправкой.
   Это значение также доступно при передаче
   константы <constant>CURLINFO_QUEUE_TIME_T</constant> в параметр <parameter>option</parameter>
   функции <function>curl_getinfo</function>.
  </simpara>

  <simpara>
   Добавили поддержку опции <constant>CURLOPT_SSL_SIGNATURE_ALGORITHMS</constant>,
   через которую указывают алгоритмы подписи для протокола TLS.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.dom">
  <title>Модуль DOM</title>

  <simpara>
   Добавили свойство <property>Dom\Element::$outerHTML</property>.
  </simpara>

  <simpara>
   Добавили свойство <property>$children</property>
   в реализацию интерфейса <interfacename>Dom\ParentNode</interfacename>.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.exif">
  <title>Модуль EXIF</title>

  <simpara>
   Добавили поддержку Exif-тегов <literal>OffsetTime*</literal>.
  </simpara>

  <simpara>
   Добавили поддержку формата HEIF/HEIC.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.filter">
  <title>Фильтрация данных</title>

  <simpara>
   Добавили новый флаг <constant>FILTER_THROW_ON_FAILURE</constant>
   для функций фильтрации. Флаг заставит функцию выбросить исключение, если значение не прошло фильтрацию.
   Новый флаг нельзя комбинировать с флагом <constant>FILTER_NULL_ON_FAILURE</constant>;
   при попытке объединить флаги PHP выбросит ошибку <exceptionname>ValueError</exceptionname>.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.intl">
  <title>Модуль интернационализации</title>

  <simpara>
   Добавили константы класса: <constant>NumberFormatter::CURRENCY_ISO</constant>,
   <constant>NumberFormatter::CURRENCY_PLURAL</constant>,
   <constant>NumberFormatter::CASH_CURRENCY</constant>
   и <constant>NumberFormatter::CURRENCY_STANDARD</constant>
   для форматов чисел, связанных с валютой.
  </simpara>

  <simpara>
   Добавили методы <methodname>Locale::addLikelySubtags</methodname>
   и <methodname>Locale::minimizeSubtags</methodname> для обработки вероятных тегов
   заданной локали.
  </simpara>

  <simpara>
   Добавили класс <classname>IntlListFormatter</classname> для форматирования, упорядочивания
   и пунктуации списка элементов с заданной локалью:
   операнды <constant>IntlListFormatter::TYPE_AND</constant>,
   <constant>IntlListFormatter::TYPE_OR</constant>,
   <constant>IntlListFormatter::TYPE_UNITS</constant>,
   а также ширины <constant>IntlListFormatter::WIDTH_WIDE</constant>,
   <constant>IntlListFormatter::WIDTH_SHORT</constant>,
   <constant>IntlListFormatter::WIDTH_NARROW</constant>.
   Поддерживается начиная с библиотеки ICU 67.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.pdo-sqlite">
  <title>Драйвер PDO_Sqlite</title>

  <simpara>
   В класс добавили константу <constant>Pdo\Sqlite::ATTR_BUSY_STATEMENT</constant>.
  </simpara>

  <simpara>
   Добавили константы класса: <constant>Pdo\Sqlite::ATTR_EXPLAIN_STATEMENT</constant>,
   <constant>Pdo\Sqlite::EXPLAIN_MODE_PREPARED</constant>,
   <constant>Pdo\Sqlite::EXPLAIN_MODE_EXPLAIN</constant>,
   <constant>Pdo\Sqlite::EXPLAIN_MODE_EXPLAIN_QUERY_PLAN</constant>.
  </simpara>

  <simpara>
   Добавили атрибут соединения <constant>Pdo\Sqlite::ATTR_TRANSACTION_MODE</constant>
   с возможными значениями <constant>Pdo\Sqlite::TRANSACTION_MODE_DEFERRED</constant>,
   <constant>Pdo\Sqlite::TRANSACTION_MODE_IMMEDIATE</constant> и <constant>Pdo\Sqlite::TRANSACTION_MODE_EXCLUSIVE</constant>
   для настройки режима транзакции, в котором выполнится транзакция
   при вызове метода beginTransaction().
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.session">
  <title>Сессии</title>

  <simpara>
   Функции <function>session_set_cookie_params</function>,
   <function>session_get_cookie_params</function>,
   и <function>session_start</function>теперь поддерживают ключ <literal>"partitioned"</literal>
   для секционирования данных cookie.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.soap">
  <title>Модуль SOAP</title>

  <simpara>
   Варианты перечисления теперь выгружаются методом <methodname>SoapClient::__getTypes</methodname>.
  </simpara>

  <simpara>
   Добавили поддержку атрибута xml:lang для элемента Reason Text в протоколе SOAP 1.2.
  </simpara>

  <simpara>
   В сигнатуру методов <methodname>SoapFault::__construct</methodname>
   и <methodname>SoapServer::fault</methodname> добавили необязательный параметр 
   <parameter>lang</parameter>. Параметр решает проблему совместимости
   с SOAP-клиентами на платформе .NET.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.standard">
  <title>Стандартные модули</title>

  <simpara>
   Функция <function>mail</function> теперь возвращает фактическую ошибку процесса 
   sendmail и распознаёт его внезапное завершение. 
   В таких случаях PHP выдаёт предупреждение и функция возвращает &false;. 
   Раньше эти ошибки игнорировались. Изменение затрагивает только 
   транспорт sendmail.
  </simpara>

  <simpara>
   Функция <function>getimagesize</function> теперь поддерживает изображения в формате HEIF/HEIC.
  </simpara>

  <simpara>
   Функция <function>getimagesize</function> теперь поддерживает изображения в формате SVG,
   если установили библиотеку ext-libxml.
   Аналогично, функции <function>image_type_to_extension</function>
   и <function>image_type_to_mime_type</function>
   теперь тоже обрабатывают константу IMAGETYPE_SVG.
  </simpara>

  <simpara>
   Массив, который возвращается функцией <function>getimagesize</function>,
   теперь содержит две дополнительные записи:
   <literal>"width_unit"</literal> и <literal>"height_unit"</literal>, которые указывают, в каких единицах выражаются размеры.
   По умолчанию размеры выражаются в пикселях — px.
   Не в каждом изображении единицы совпадают, например, размер одного направления выражается в сантиметрах — cm, а другого в пикселях — px.
  </simpara>

  <simpara>
   Функции <function>setcookie</function> и <function>setrawcookie</function>
   теперь поддерживают ключ <literal>"partitioned"</literal>.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.uri">
  <title>Модуль URI</title>

  <simpara>
   Добавили встроенный модуль URI, который теперь включён по умолчанию.
   Модуль предоставляет инструменты для обработки URI-идентификаторов и URL-адресов по правилам стандартов RFC 3986 и WHATWG.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.xsl">
  <title>Модуль XSL</title>

  <simpara>
   Аргумент <parameter>namespace</parameter> в методах
   <methodname>XSLTProcessor::getParameter</methodname>,
   <methodname>XSLTProcessor::setParameter</methodname>
   и <methodname>XSLTProcessor::removeParameter</methodname> теперь обрабатывается корректно
   и не игнорируется как пустой. Аргумент работает, только если параметр
   <parameter>name</parameter> указали не в нотации Кларка или QName-имени, 
   поскольку при таком формате значения пространство имён извлекается из префикса
   или атрибута href самого имени.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.zlib">
  <title>Модуль Zlib</title>

  <simpara>
   Функция <function>flock</function> теперь поддерживает потоки zlib.
   Раньше попытки установить блокировку в таких потоках завершались ошибкой.
  </simpara>

 </sect2>

</sect1>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
