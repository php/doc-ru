<?xml version="1.0" encoding="utf-8"?>
<!-- EN-Revision: ec45af749649dc0d6a23eaedeed1b601f7460813 Maintainer: sergey Status: ready -->
<!-- Reviewed: no -->
<sect1 xml:id="migration85.new-features" xmlns:xlink="http://www.w3.org/1999/xlink">
 <title>Новая функциональность</title>

 <sect2 xml:id="migration85.new-features.core">
  <title>Ядро PHP</title>

  <sect3 xml:id="migration85.new-features.core.pipe-operator">
   <title>Оператор Pipe</title>

   <simpara>
    Добавлен оператор <link linkend="language.operators.functional">pipe (<literal>|&gt;</literal>)</link>.
   </simpara>

   <informalexample>
    <programlisting role="php">
<![CDATA[
<?php
$result = "Hello World" |> strlen(...);
print $result . PHP_EOL;  // Prints "11"
]]>
    </programlisting>
   </informalexample>
  </sect3>

  <sect3 xml:id="migration85.new-features.core.closures-in-constexpr">
   <title>Замыкания в константных выражениях</title>

   <para>
    Добавлена поддержка <link linkend="class.closure">замыканий</link> и
    <link linkend="functions.first_class_callable_syntax">объектов первого класса</link>
    в константных выражениях. Поддерживаются:

    <simplelist>
     <member>Параметры атрибутов.</member>
     <member>Значения свойств и параметров по умолчанию.</member>
     <member>Константы и константы классов.</member>
    </simplelist>
   </para>
  </sect3>

  <sect3 xml:id="migration85.new-features.core.nodiscard-attribute">
   <title>Атрибут #[\NoDiscard]</title>

   <simpara>
    Добавлен атрибут <classname>NoDiscard</classname> для указания,
    что возвращаемое значение функции является важным и должно быть использовано.
   </simpara>

   <simpara>
    Также добавлено приведение типа <literal>(void)</literal> для указания,
    что значение не используется намеренно.
    Приведение типа <literal>(void)</literal> само по себе не влияет на выполнение программы,
    но может использоваться для подавления предупреждений,
    выдаваемых атрибутом <code>#[\NoDiscard]</code>, а также, возможно,
    диагностических сообщений, выдаваемых внешними IDE или инструментами статического анализа.
   </simpara>

   <informalexample>
    <programlisting role="php">
<![CDATA[
<?php

#[\NoDiscard]
function concat(string $a, string $b): string {
     return a + b;
}

// Предупреждение: Возвращаемое значение функции concat() должно быть либо использовано,
// либо намеренно проигнорировано путём приведения его к типу (void) в xxx.php.
concat("a", "b");

// Предупреждение не выдаётся, поскольку возвращаемое значение используется в присваивании.
$results = concat("a", "b");

// Предупреждение не выдаётся, поскольку используется приведение типа (void).
(void)concat("a", "b");
]]>
    </programlisting>
   </informalexample>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.attributes-on-constants">
   <title>Атрибуты констант</title>

   <simpara>
    Добавлена поддержка атрибутов для констант, не относящихся к классам, на этапе компиляции
    (например, <code>const MY_CONST = 1;</code> вместо <code>define('MY_CONST', 1);</code>).
   </simpara>

   <simpara>
    Атрибут <classname>Deprecated</classname> теперь можно использовать для констант.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.delayedtargetvalidation-attribute">
   <title>Атрибут <code>#[\DelayedTargetValidation]</code></title>

   <simpara>
    Новый атрибут <classname>DelayedTargetValidation</classname> можно использовать
    для подавления ошибок компиляции из атрибутов ядра (или модулей),
    которые используются на недопустимых целях.
    Вместо этого ошибки сообщаются во время выполнения,
    если и когда вызывается метод <methodname>ReflectionAttribute::newInstance</methodname>.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.override-for-properties">
   <title>Атрибут <code>#[\Override]</code> для свойств</title>

   <simpara>
    Атрибут <classname>Override</classname> теперь можно применять к свойствам.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.static-aviz">
   <title>Асимметричная видимость статических свойств</title>

   <simpara>
    Добавлена поддержка <link linkend="language.oop5.visibility-members-aviz">асимметричной видимости</link>
    для статических свойств.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.backtraces-for-fatal-errors">
   <title>Трассировки для фатальных ошибок</title>

   <simpara>
    Фатальные ошибки (такие как превышение максимального времени выполнения)
    теперь включают обратную трассировку.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.final-property-promotion">
   <title>Объявление окончательных свойств в конструкторе</title>

   <simpara>
    <link linkend="language.oop5.decon.constructor.promotion">Объявление свойств в конструкторе</link>
    теперь можно использовать для окончательных (final) свойств.
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.casts-in-constexpr">
   <title>Приведения типов в константных выражениях</title>

   <simpara>
    Добавлена поддержка приведения типов в константных выражениях.
   </simpara>

   <informalexample>
    <programlisting role="php">
<![CDATA[
<?php
const T1 = (int) 0.3; // Ранее: "Фатальная ошибка: константное выражение содержит недопустимые операции"
print T1 . PHP_EOL;   // Сейчас выведет "0"
]]>
    </programlisting>
   </informalexample>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.clone-function">
   <title>Функция clone</title>

   <simpara>
    Языковая конструкция <link linkend="language.oop5.cloning">clone</link>
    теперь является функцией и поддерживает переназначение (только для чтения) свойств
    во время клонирования с помощью нового параметра <property>$withProperties</property>.
   </simpara>

  </sect3>

 </sect2>

 <sect2 xml:id="migration85.new-features.curl">
  <title>Модуль cURL</title>

  <simpara>
   Добавлена поддержка <link linkend="class.curlsharepersistenthandle">совместного использования дескрипторов</link>,
   которые сохраняются между несколькими запросами PHP,
   что позволяет безопасно и более эффективно повторно использовать соединения.
  </simpara>

  <simpara>
   Добавлена поддержка констант <constant>CURLINFO_USED_PROXY</constant> (libcurl >= 8.7.0),
   <constant>CURLINFO_HTTPAUTH_USED</constant> и <constant>CURLINFO_PROXYAUTH_USED</constant> (libcurl >= 8.12.0)
   в функции <function>curl_getinfo</function>.
   Если функция <function>curl_getinfo</function> возвращает массив, та же информация доступна
   в виде ключей <literal>"used_proxy"</literal>,
   <literal>"httpauth_used"</literal> и <literal>"proxyauth_used"</literal>.
   Константа <constant>CURLINFO_USED_PROXY</constant> получает значение ноль,
   если в предыдущей передаче не использовался прокси или значение, отличное от нуля, если прокси использовался.
   Константы <constant>CURLINFO_HTTPAUTH_USED</constant> и <constant>CURLINFO_PROXYAUTH_USED</constant>
   получают битовые маски, указывающие методы аутентификации HTTP и прокси,
   которые использовались в предыдущем запросе.
   Возможные значения смотрите в описании констант <constant>CURLAUTH_<replaceable>*</replaceable></constant>.
  </simpara>

  <simpara>
   Добавлена опция cURL <constant>CURLOPT_INFILESIZE_LARGE</constant>,
   которая является безопасной заменой константы <constant>CURLOPT_INFILESIZE</constant>.
   В некоторых системах <constant>CURLOPT_INFILESIZE</constant> принимает только
   32-разрядное целое число со знаком в качестве размера файла (2,0 ГБ) даже в 64-разрядных системах.
   Константа <constant>CURLOPT_INFILESIZE_LARGE</constant> принимает наибольшее целое значение,
   которое может обработать система.
  </simpara>

  <simpara>
   Добавлены значения <constant>CURLFOLLOW_OBEYCODE</constant>, <constant>CURLFOLLOW_FIRSTONLY</constant>
   и <constant>CURLFOLLOW_ALL</constant> для опции <constant>CURLOPT_FOLLOWLOCATION</constant>
   функции <function>curl_setopt</function>.
   Константа <constant>CURLFOLLOW_OBEYCODE</constant> для более строгого соблюдения перенаправлений, если они разрешены.
   Коснатнта <constant>CURLFOLLOW_FIRSTONLY</constant> для соблюдения только первого перенаправления,
   таким образом, если есть последующие перенаправления, они не будут выполняться.
   Константа <constant>CURLFOLLOW_ALL</constant> эквивалентна установке
   константе <constant>CURLOPT_FOLLOWLOCATION</constant> значения true.
  </simpara>

  <simpara>
   Добавлена поддержка <constant>CURLINFO_CONN_ID</constant> (libcurl >= 8.2.0)
   для функции <function>curl_getinfo</function>. Константа позволяет получить
   уникальный идентификатор соединения, используемого для передачи cURL.
   Это в первую очередь полезно, когда в приложениях на уровне PHP требуется
   повторное использование соединений или логика пула соединений.
   Если функция <function>curl_getinfo</function> возвращает массив,
   значение доступно как ключ <literal>"conn_id"</literal>.
  </simpara>

  <simpara>
   Добавлена поддержка <constant>CURLINFO_QUEUE_TIME_T</constant> (libcurl >= 8.6.0)
   для функции <function>curl_getinfo</function>. Константа позволяет получить время (в микросекундах),
   которое запрос провёл в очереди соединений libcurl перед отправкой.
   Это значение также можно получить, передав
   константу <constant>CURLINFO_QUEUE_TIME_T</constant> в параметр <parameter>option</parameter>
   функции <function>curl_getinfo</function>.
  </simpara>

  <simpara>
   Добавлена поддержка <constant>CURLOPT_SSL_SIGNATURE_ALGORITHMS</constant>
   для указания алгоритмов подписи, которые будут использоваться для TLS.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.dom">
  <title>Модуль DOM</title>

  <simpara>
   Добавлено свойство <property>Dom\Element::$outerHTML</property>.
  </simpara>

  <simpara>
   Добавлено свойство <property>$children</property> в
   реализацию интерфейса <interfacename>Dom\ParentNode</interfacename>.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.exif">
  <title>Модуль EXIF</title>

  <simpara>
   Добавлена поддержка тегов Exif <literal>OffsetTime*</literal>.
  </simpara>

  <simpara>
   Добавлена поддержка HEIF/HEIC.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.filter">
  <title>Фильтрация данных</title>

  <simpara>
   Добавлен новый флаг <constant>FILTER_THROW_ON_FAILURE</constant> для передачи
   в функции фильтрации, который при выявлении ошибки при проверке выбрасывает исключение.
   Новый флаг нельзя комбинировать с <constant>FILTER_NULL_ON_FAILURE</constant>;
   попытка сделать это приведёт к выбрасыванию исключения <exceptionname>ValueError</exceptionname>.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.intl">
  <title>Модуль интернационализации</title>

  <simpara>
   Добавлены константы класса <constant>NumberFormatter::CURRENCY_ISO</constant>,
   <constant>NumberFormatter::CURRENCY_PLURAL</constant>,
   <constant>NumberFormatter::CASH_CURRENCY</constant>
   и <constant>NumberFormatter::CURRENCY_STANDARD</constant>
   для различных форматов чисел, связанных с валютой.
  </simpara>

  <simpara>
   Добавлены методы <methodname>Locale::addLikelySubtags</methodname> и
   <methodname>Locale::minimizeSubtags</methodname> для обработки вероятных тегов
   заданной локали.
  </simpara>

  <simpara>
   Добавлен класс <classname>IntlListFormatter</classname> для форматирования, упорядочивания
   и пунктуации списка элементов с заданной локалью:
   операнды <constant>IntlListFormatter::TYPE_AND</constant>,
   <constant>IntlListFormatter::TYPE_OR</constant>,
   <constant>IntlListFormatter::TYPE_UNITS</constant>
   а также ширины <constant>IntlListFormatter::WIDTH_WIDE</constant>,
   <constant>IntlListFormatter::WIDTH_SHORT</constant>,
   <constant>IntlListFormatter::WIDTH_NARROW</constant>.
   Поддерживается начиная с icu 67.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.pdo-sqlite">
  <title>Драйвер PDO_Sqlite</title>

  <simpara>
   Добавлена константа класса <constant>Pdo\Sqlite::ATTR_BUSY_STATEMENT</constant>.
  </simpara>

  <simpara>
   Добавлена константы класса <constant>Pdo\Sqlite::ATTR_EXPLAIN_STATEMENT</constant>,
   <constant>Pdo\Sqlite::EXPLAIN_MODE_PREPARED</constant>,
   <constant>Pdo\Sqlite::EXPLAIN_MODE_EXPLAIN</constant>,
   <constant>Pdo\Sqlite::EXPLAIN_MODE_EXPLAIN_QUERY_PLAN</constant>.
  </simpara>

  <simpara>
   Добавлен атрибут соединения <constant>Pdo\Sqlite::ATTR_TRANSACTION_MODE</constant>
   с возможными значениями <constant>Pdo\Sqlite::TRANSACTION_MODE_DEFERRED</constant>,
   <constant>Pdo\Sqlite::TRANSACTION_MODE_IMMEDIATE</constant> и <constant>Pdo\Sqlite::TRANSACTION_MODE_EXCLUSIVE</constant>,
   что позволяет настроить режим транзакции, который будет использоваться
   при вызове метода beginTransaction().
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.session">
  <title>Сессии</title>

  <simpara>
   Функции <function>session_set_cookie_params</function>,
   <function>session_get_cookie_params</function>,
   и <function>session_start</function> теперь поддерживают cookie с независимым разделенным состоянием
   с помощью ключа <literal>"partitioned"</literal>.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.soap">
  <title>Модуль SOAP</title>

  <simpara>
   Варианты перечисления теперь выгружаются методом <methodname>SoapClient::__getTypes</methodname>.
  </simpara>

  <simpara>
   Добавлена поддержка атрибута xml:lang в Soap 1.2 Reason Text.
  </simpara>

  <simpara>
   Добавлен опциональный параметр <parameter>$lang</parameter> в
   подпись <methodname>SoapFault::__construct</methodname> и
   <methodname>SoapServer::fault</methodname>.
   Это решает проблему совместимости с клиентами .NET SOAP.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.standard">
  <title>Стандартные модули</title>

  <simpara>
   Функция <function>mail</function> теперь возвращает фактическую ошибку
   sendmail и определяет, был ли процесс sendmail неожиданно прерван.
   В таких случаях выдаётся предупреждение и функция возвращает значение false.
   Ранее ошибки игнорировались без предупреждения.
   Это изменение затрагивает только транспорт sendmail.
  </simpara>

  <simpara>
   Функция <function>getimagesize</function> теперь поддерживает изображения HEIF/HEIC.
  </simpara>

  <simpara>
   Функция <function>getimagesize</function> теперь поддерживает изображения SVG,
   если установлена библиотека ext-libxml.
   Аналогично, функции <function>image_type_to_extension</function> и
   <function>image_type_to_mime_type</function>
   теперь также обрабатывают IMAGETYPE_SVG.
  </simpara>

  <simpara>
   У массив, возвращаемого функцией <function>getimagesize</function>,
   появилось две дополнительные записи:
   <literal>"width_unit"</literal> и <literal>"height_unit"</literal> для указания единиц измерения размеров.
   По умолчанию эти единицы измерения — px.
   Они не обязательно должны быть одинаковыми (например, одна может быть cm, а другая — px).
  </simpara>

  <simpara>
   Функции <function>setcookie</function> и <function>setrawcookie</function>
   теперь поддерживают ключ <literal>"partitioned"</literal>.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.uri">
  <title>Модуль URI</title>

  <simpara>
   Добавлен всегда включённый модуль URI, который можно использовать
   для обработки URI и URL в соответствии с RFC 3986 и WHATWG URL.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.xsl">
  <title>Модуль XSL</title>

  <simpara>
   Аргумент <parameter>$namespace</parameter> методов <methodname>XSLTProcessor::getParameter</methodname>,
   <methodname>XSLTProcessor::setParameter</methodname> и
   <methodname>XSLTProcessor::removeParameter</methodname> теперь действительно работает,
   а не рассматривается как пустой.
   Работает только в том случае, если аргумент <parameter>$name</parameter>
   не использует нотацию Кларка и не является QName,
   поскольку в этих случаях пространство имён берётся из href или префикса пространства имён соответственно.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.zlib">
  <title>Модуль Zlib</title>

  <simpara>
   Функция <function>flock</function> теперь поддерживается в потоках zlib.
   Ранее это всегда приводило к сбою при выполнении любых действий по блокировке.
  </simpara>

 </sect2>

</sect1>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
