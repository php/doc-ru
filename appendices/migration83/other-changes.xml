<?xml version="1.0" encoding="utf-8"?>
<!-- EN-Revision: 307ee0078a4c33f4766e3f467612be7c528327ec Maintainer: sergey Status: ready -->
<!-- Reviewed: no -->
<sect1 xml:id="migration83.other-changes" xmlns:xlink="http://www.w3.org/1999/xlink">
 <title>Другие изменения</title>

 <sect2 xml:id="migration83.other-changes.core">
  <title>Изменения в ядре</title>

  <sect3 xml:id="migration83.other-changes.core.ffi">
   <title>Класс FFI</title>

   <para>
    Метод <methodname>FFI::load</methodname> теперь разрешён в режиме предварительной загрузки,
    когда опция <link linkend="ini.opcache.preload-user">opcache.preload_user</link> —
    это текущий пользователь системы. Ранее
    вызов метода <methodname>FFI::load</methodname> не был возможен
    во время предзагрузки, если
    настройка директивы <link linkend="ini.opcache.preload-user">opcache.preload_user</link>
    была установлена.
   </para>
  </sect3>

  <sect3 xml:id="migration83.other-changes.core.fpm">
   <title>Менеджер процессов FPM</title>

   <para>
    Проверка FPM CLI теперь завершается неудачей, если путь к сокету длиннее, чем поддерживает операционная система.
   </para>
  </sect3>

  <sect3 xml:id="migration83.other-changes.core.opcache">
   <title>Модуль Opcache</title>

   <para>
    В CLI и phpdbg SAPIs предварительная загрузка больше не требует
    настройки директивы <link linkend="ini.opcache.preload-user">opcache.preload_user</link>
    при запуске от имени пользователя root.
    В других SAPIs эта директива нужна при запуске от имени пользователя root,
    потому что предзагрузка выполнялась до того, как SAPI переключится на непривилегированного пользователя.
   </para>
  </sect3>

  <sect3 xml:id="migration83.other-changes.core.streams">
   <title>Потоки</title>

   <para>
    Блокировка функцией <function>fread</function> при подключении к сокету возвращается немедленно,
    если есть любые буферизованные данные, вместо ожидания дополнительных данных.
   </para>

   <para>
    Поток памяти больше не завершается сбоем, если смещение поиска превысило конечное значение.
    Вместо этого память будет увеличена при следующей записи, а данные между
    старым концом и смещением заполнятся нулевыми байтами, аналогично работе файлов.
   </para>

   <para>
    Операции доступа функции <function>stat</function>
    наподобие функции <function>file_exists</function> и похожие теперь пользуются реальным
    путём вместо фактического пути потока. Это соответствует открытию
    потока.
   </para>
  </sect3>
 </sect2>

 <sect2 xml:id="migration83.other-changes.sapi">
  <title>Изменения в модулях SAPI</title>

  <sect3 xml:id="migration83.other-changes.sapi.cli">
   <title>Командная строка (CLI)</title>

   <para>
    Потоки <constant>STDOUT</constant>, <constant>STDERR</constant>
    и <constant>STDIN</constant> больше не закрываются при уничтожении ресурсов,
    что обычно случается при завершении работы CLI.
    Однако всё ещё можно явно закрыть эти потоки
    через функцию <function>fclose</function> и похожие.
   </para>
  </sect3>
 </sect2>

 <sect2 xml:id="migration83.other-changes.functions">
  <title>Изменённые функции</title>

  <sect3 xml:id="migration83.other-changes.functions.core">
   <title>Ядро</title>

   <para>
    В функцию <function>gc_status</function> добавлено 8 следующих полей:

    <simplelist>
     <member><literal>running</literal> => bool</member>
     <member><literal>protected</literal> => bool</member>
     <member><literal>full</literal> => bool</member>
     <member><literal>buffer_size</literal> => int</member>
     <member><literal>application_time</literal> => float: Полное время
     работы приложения в секундах (включая время, затраченное полем collector_time)</member>
     <member><literal>collector_time</literal> => float: Время в секундах,
     затраченное циклами сборки (включая время, затраченное полями destructor_time и free_time)</member>
     <member><literal>destructor_time</literal> => float: Время в секундах, затраченное
     деструкторами в течение цикла сборки</member>
     <member><literal>free_time</literal> => float: Время в секундах, затраченное на освобождение значений
     во время цикла сборки</member>
    </simplelist>
   </para>

   <para>
    Функция <function>class_alias</function> теперь поддерживает создание псевдонимов
    внутреннего класса.
   </para>

   <para>
    Настройка <link linkend="ini.open-basedir">open_basedir</link> с вызовом
    во время выполнения функции <code>ini_set('open_basedir', ...);</code> больше не принимает пути,
    содержащие родительскую директорию (<literal>..</literal>). Ранее
    запрещались только пути, начинающиеся с <literal>..</literal>. Это можно
    легко обойти, добавив <literal>./</literal> к пути.
   </para>

   <para>
    Обработчики пользовательских исключений теперь перехватывают их во время завершения работы.
   </para>

   <para>
    Результирующий HTML в функциях <function>highlight_string</function>
    и <function>highlight_file</function> был изменён.
    Пробел между внешними HTML-тегами удалены. Новые строки и пробелы
    больше не преобразовываются в HTML-сущности. Полный HTML теперь обёрнут
    тегом <literal>&lt;pre&gt;</literal>. Внешний тег <literal>&lt;span&gt;</literal>
    был слит с тегом <literal>&lt;code&gt;</literal>.
   </para>

  </sect3>

  <sect3 xml:id="migration83.other-changes.functions.calendar">
   <title>Модуль Calendar</title>

   <para>
    Функция <function>easter_date</function> теперь поддерживает годы с 1970
    по 2 000 000 000 на 64-битных системах, ранее она поддерживала только годы
    в диапазоне 1970—2037.
   </para>
  </sect3>

  <sect3 xml:id="migration83.other-changes.functions.curl">
   <title>Модуль Curl</title>

   <para>
    Функция <function>curl_getinfo</function> теперь поддерживает две новых константы:
    <constant>CURLINFO_CAPATH</constant>
    и <constant>CURLINFO_CAINFO</constant>. Если параметр option принимает значение &null;,
    будут представлены два следующих дополнительных ключа:
    <literal>capath</literal> и <literal>cainfo</literal>.
   </para>
  </sect3>

  <sect3 xml:id="migration83.other-changes.functions.dom">
   <title>Модуль DOM</title>

   <para>
    У метода <methodname>DOMCharacterData::appendData</methodname> предопределённый тип
    возвращаемого значения изменился на <type>true</type>.
   </para>

   <para>
    У методов <methodname>DOMDocument::loadHTML</methodname>,
    <methodname>DOMDocument::loadHTMLFile</methodname>
    и <methodname>DOMDocument::loadXML</methodname> предварительный тип
    возвращаемого значения был изменён на <type>bool</type>. Раньше это было задокументировано
    как <code>DOMDocument|bool</code>, но начиная с PHP 8.0.0
    объект класса <classname>DOMDocument</classname>
    не может быть возвращён, поскольку он больше не может быть вызван статически.
   </para>

  </sect3>

  <sect3 xml:id="migration83.other-changes.functions.gd">
   <title>Модуль Gd</title>

   <para>
    Сигнатура функции <function>imagerotate</function> изменилась.
    Параметр <parameter>$ignore_transparent</parameter> был удалён,
    поскольку он игнорировался с версии PHP 5.5.0.
   </para>
  </sect3>

  <sect3 xml:id="migration83.other-changes.functions.intl">
   <title>Модуль интернационализации Intl</title>

   <para>
    Функция <function>datefmt_set_timezone</function> (и её псевдоним
    — метод <methodname>IntlDateformatter::setTimeZone</methodname>)
    теперь возвращают значение &true; при успешном выполнении, ранее они возвращали значение &null;.
   </para>

   <para>
    <methodname>IntlBreakiterator::setText</methodname> now returns &false;
    on failure, previously &null; was returned.
    It now returns &true; on success, previously &null; was returned.
   </para>

   <para>
    <methodname>IntlChar::enumCharNames</methodname> is now returning a boolean.
    Previously it returned &null; on success and &false; on failure.
   </para>

   <para>
    <methodname>IntlDateFormatter::__construct</methodname> throws an <constant>U_ILLEGAL_ARGUMENT_ERROR</constant>
    exception when an invalid locale had been set.
   </para>
  </sect3>

  <sect3 xml:id="migration83.other-changes.functions.mbstring">
   <title>MBString</title>

   <para>
    <function>mb_strtolower</function> and <function>mb_convert_case</function>
    implement conditional casing rules for the Greek letter sigma.
    For <function>mb_convert_case</function>,
    conditional casing only applies to <constant>MB_CASE_LOWER</constant>
    and <constant>MB_CASE_TITLE</constant> modes, not to
    <constant>MB_CASE_LOWER_SIMPLE</constant> and
    <constant>MB_CASE_TITLE_SIMPLE</constant>.
   </para>

   <para>
    <function>mb_decode_mimeheader</function> interprets underscores in
    QPrint-encoded MIME encoded words as required by RFC 2047; they are
    converted to spaces.
    Underscores must be encoded as <literal>"=5F"</literal> in such MIME
    encoded words.
   </para>

   <para>
    In rare cases, <function>mb_encode_mimeheader</function> will transfer-encode
    its input string where it would pass it through as raw ASCII in PHP 8.2.
   </para>

   <para>
    <function>mb_encode_mimeheader</function> no longer drops NUL (zero)
    bytes when QPrint-encoding the input string.
    This previously caused strings in certain text encodings, especially
    UTF-16 and UTF-32, to be corrupted by mb_encode_mimeheader.
   </para>

   <para>
    <function>mb_detect_encoding</function>'s "non-strict" mode now behaves
    as described in the documentation.
    Previously, it would return &false; if the same byte (for example, the first
    byte) of the input string was invalid in all candidate encodings.
    More generally, it would eliminate candidate encodings from consideration
    when an invalid byte was seen, and if the same input byte eliminated all
    remaining encodings still under consideration, it would return &false;.
    On the other hand, if all candidate encodings but one were eliminated
    from consideration, it would return the last remaining one without regard
    for how many encoding errors might be encountered later in the string.
    This is different from the behavior described in the documentation, which
    says: "If strict is set to false, the closest matching encoding will be
    returned."
   </para>
  </sect3>

  <sect3 xml:id="migration83.other-changes.functions.mysqli">
   <title>mysqli</title>

   <para>
    <function>mysqli_fetch_object</function> now raises a
    <classname>ValueError</classname> instead of an <classname>Exception</classname>
    when the <parameter>$constructor_args</parameter> argument is non empty with
    the class not having constructor.
   </para>

   <para>
    <function>mysqli_poll</function> now raises a <classname>ValueError</classname>
    when neither the <parameter>$read</parameter>
    nor the <parameter>$error</parameter> arguments are passed.
   </para>

   <para>
    <function>mysqli_field_seek</function> and
    <methodname>mysqli_result::field_seek</methodname> now specify the return
    type as <type>true</type> instead of <type>bool</type>.
   </para>
  </sect3>

  <sect3 xml:id="migration83.other-changes.functions.odbc">
   <title>ODBC</title>

   <para>
    <function>odbc_autocommit</function> now accepts &null; for the
    <parameter>$enable</parameter> parameter.
    Passing &null; has the same behaviour as passing only 1 parameter,
    namely indicating if the autocommit feature is enabled or not.
   </para>
  </sect3>

  <sect3 xml:id="migration83.other-changes.functions.pgsql">
   <title>PGSQL</title>

   <para>
    <function>pg_fetch_object</function> now raises a
    <classname>ValueError</classname> instead of an <classname>Exception</classname>
    when the <parameter>$constructor_args</parameter> argument is non empty with
    the class not having constructor.
   </para>

   <para>
    <function>pg_insert</function> now raises a <classname>ValueError</classname>
    instead of a <constant>E_WARNING</constant> when the table specified is invalid.
   </para>

   <para>
    <function>pg_insert</function> and <function>pg_convert</function> raises
    a <classname>ValueError</classname> or a <classname>TypeError</classname>
    instead of a <constant>E_WARNING</constant> when the value/type of a field
    does not match properly with a PostgreSQL's type.
   </para>

   <para>
    The <parameter>$row</parameter> parameter of
    <function>pg_fetch_result</function>,
    <function>pg_field_prtlen</function>, and
    <function>pg_field_is_null</function> is now nullable.
   </para>
  </sect3>

  <sect3 xml:id="migration83.other-changes.functions.random">
   <title>Random</title>

   <para>
    Changed <function>mt_srand</function> and <function>srand</function> to
    not check the number of arguments to determine whether a random seed should
    be used. Passing &null; will generate a random seed, <literal>0</literal>
    will use zero as the seed. The functions are now consistent with
    <methodname>Random\Engine\Mt19937::__construct</methodname>.
   </para>

  </sect3>

  <sect3 xml:id="migration83.other-changes.functions.reflection">
   <title>Reflection</title>

   <para>
    Return type of <methodname>ReflectionClass::getStaticProperties</methodname>
    is no longer nullable.
   </para>
  </sect3>

  <sect3 xml:id="migration83.other-changes.functions.standard">
   <title>Standard</title>

   <para>
    <constant>E_NOTICE</constant>s emitted by <function>unserialize</function>
    have been promoted to <constant>E_WARNING</constant>.
    <!-- RFC: https://wiki.php.net/rfc/improve_unserialize_error_handling -->
   </para>

   <para>
    <function>unserialize</function> now emits a new <constant>E_WARNING</constant>
    if the input contains unconsumed bytes.
    <!-- RFC: https://wiki.php.net/rfc/unserialize_warn_on_trailing_data -->
   </para>

   <para>
    <function>array_pad</function> is now only limited by the maximum number of
    elements an array can have. Before, it was only possible to add at most 1048576
    elements at a time.
   </para>

   <para>
    <function>strtok</function> raises an <constant>E_WARNING</constant> in the
    case token is not provided when starting tokenization.
   </para>

   <para>
    <function>password_hash</function> will now chain the underlying
    <classname>Random\RandomException</classname>
    as the <classname>ValueError</classname>'s <parameter>$previous</parameter>
    <classname>Exception</classname> when salt generation fails.
   </para>

   <para>
    If using an array as the <parameter>$command</parameter>
    for <function>proc_open</function>, it must now have at least one
    non empty element. Otherwise a <classname>ValueError</classname>
    is thrown.
   </para>

   <para>
    <function>proc_open</function> returns false if <parameter>$command</parameter>
    array is invalid command instead of resource object that produces warning later.
    This was already the case for Windows but it is now also the case if posix_spawn
    implementation is in use (most Linux, BSD and MacOS platforms). There are still
    some old platforms where this behavior is not changed as posix_spawn is not
    supported there.
   </para>

   <para>
    <function>array_sum</function> and <function>array_product</function> now
    warn when values in the array cannot be converted to int/float.
    Previously arrays and objects where ignored whilst every other value was
    cast to int. Moreover, objects that define a numeric cast (e.g.
    <link linkend="book.gmp">GMP</link>) are now casted instead of ignored.
    <!-- RFC: https://wiki.php.net/rfc/saner-array-sum-product -->
   </para>

   <para>
    The <parameter>$decimal</parameter> of <function>number_format</function>
    now properly handles negative integers.
    Rounding with a negative value for <parameter>$decimal</parameter> means
    that <parameter>$num</parameter> is rounded to <parameter>$decimals</parameter>
    significant digits before the decimal point.
    Previously negative <parameter>$decimals</parameter> were silently
    ignored and the number got rounded to zero decimal places.
   </para>

   <para>
    A new <parameter>$before_needle</parameter> argument has been added to
    <function>strrchr</function>. It behaves like its counterpart in the
    <function>strstr</function> or <function>stristr</function> functions.
   </para>

   <para>
    <function>str_getcsv</function> and <function>fgetcsv</function> now return
    an empty string instead of a string with a single null byte for the last field
    which only contains an unterminated enclosure.
   </para>
  </sect3>

 </sect2>

 <sect2 xml:id="migration83.other-changes.extensions">
  <title>Other Changes to Extensions</title>

  <sect3 xml:id="migration83.other-changes.extensions.core">
   <title>Core</title>

   <para>
    Using the <link linkend="language.operators.increment">increment/decrement</link>
    operators (<literal>++</literal>/<literal>--</literal>) on values of type
    <type>bool</type> now emit warnings.
    This is because it currently has no effect, but will behave like
    <code>$bool += 1</code> in the future.
   </para>

   <para>
    Using the <link linkend="language.operators.increment">decrement</link>
    operator (<literal>--</literal>) on values of type <type>null</type> now emit warnings.
    This is because it currently has no effect, but will behave like
    <code>$null -= 1</code> in the future.
   </para>

   <para>
    Internal objects that implement an _IS_NUMBER cast but not a do_operator
    handler that overrides addition and subtraction now can be incremented
    and decrement as if one would do <code>$o += 1</code> or <code>$o -= 1</code>
   </para>
  </sect3>

  <sect3 xml:id="migration83.other-changes.extensions.dom">
   <title>DOM</title>

   <para>
    The DOM lifetime mechanism has been reworked such that implicitly removed
    nodes can still be fetched. Previously this resulted in an exception.
   </para>
  </sect3>

  <sect3 xml:id="migration83.other-changes.extensions.sqlite3">
   <title>SQLite3</title>

   <para>
    The <classname>SQLite3</classname> class now throws
    <classname>SQLite3Exception</classname> (extends
    <classname>Exception</classname>) instead of <classname>Exception</classname>.
   </para>

   <para>
    The SQLite error code is now passed in the exception error code instead of
    being included in the error message.
   </para>

  </sect3>
 </sect2>

 <sect2 xml:id="migration83.other-changes.ini">
  <title>Changes to INI File Handling</title>

  <itemizedlist>
   <listitem>
    <para>
     The <literal>assert.*</literal> INI settings have been deprecated.
     This comprises the following INI settings:
     <simplelist>
      <member><link linkend="ini.assert.active">assert.active</link></member>
      <member><link linkend="ini.assert.bail">assert.bail</link></member>
      <member><link linkend="ini.assert.callback">assert.callback</link></member>
      <member><link linkend="ini.assert.exception">assert.exception</link></member>
      <member><link linkend="ini.assert.warning">assert.warning</link></member>
     </simplelist>
     If the value of the setting is equal to the default value, no deprecation
     notice is emitted.
     The <link linkend="ini.zend.assertions">zend.assertions</link> INI setting
     should be used instead.
    </para>
   </listitem>
   <listitem>
    <para>
     <!--<link linkend="ini.zend.max_allowed_stack_size">-->zend.max_allowed_stack_size<!--</link>-->
    is a new INI directive to set the maximum allowed stack size.
    Possible values are <literal>0</literal> (detect the process or thread maximum stack size),
    <literal>-1</literal> (no limit), or a positive number of bytes.
    The default is <literal>0</literal>.
    When it is not possible to detect the process or thread maximum stack
    size, a known system default is used.
    Setting this value too high has the same effect as disabling the stack size limit.
    Fibers use
    <!-- link TODO -->fiber.stack_size<!-- /link -->
    as maximum allowed stack size.
    An <classname>Error</classname> is thrown when the process call stack exceeds
    <!-- link TODO -->zend.max_allowed_stack_size-zend.reserved_stack_size<!-- /link-->
    bytes, to prevent stack-overflow-induced segmentation faults, with
    the goal of making debugging easier.
    The stack size increases during uncontrolled recursions involving internal functions
    or the magic methods
    <link linkend="object.tostring">__toString()</link>,
    <link linkend="object.clone">__clone()</link>,
    <link linkend="object.sleep">__sleep()</link>,
    <link linkend="object.destruct">__destruct()</link>.
    This is not related to stack buffer overflows, and is not a security feature.
    </para>
   </listitem>
   <listitem>
    <para>
     <!--<link linkend="ini.zend.reserved_stack_size">-->zend.reserved_stack_size<!--</link>-->
     is a new INI directive to set the reserved stack size, in bytes.
     This is subtracted from the max allowed stack size,
     as a buffer, when checking the stack size.
    </para>
   </listitem>
   </itemizedlist>
 </sect2>

 <sect2 xml:id="migration83.other-changes.performance">
  <title>Performance</title>

  <sect3 xml:id="migration83.other-changes.performance.dom">
   <title>DOM</title>

   <para>
    Looping over a <classname>DOMNodeList</classname> now uses caching. Therefore
    requesting items no longer takes quadratic time by default.
   </para>

   <para>
    Getting text content from nodes now avoids an allocation, resulting in a
    performance gain.
   </para>

   <para>
    <methodname>DOMChildNode::remove</methodname> now runs in O(1) performance.
   </para>
  </sect3>

  <sect3 xml:id="migration83.other-changes.performance.standard">
   <title>Standard</title>

   <para>
    The <function>file</function> flags error check is now about 7% faster.
   </para>
  </sect3>

  <sect3 xml:id="migration83.other-changes.performance.spl">
   <title>SPL</title>

   <para>
    <classname>RecursiveDirectoryIterator</classname> now performs less I/O
    when looping over a directory.
   </para>
  </sect3>
 </sect2>

</sect1>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
