<?xml version="1.0" encoding="utf-8"?>
<!-- EN-Revision: c17e8d4425c6267b14b72e80eb2a0a131d0d218e Maintainer: rjhdby Status: ready -->
<!-- Reviewed: no -->
<!-- $Revision$ -->
<sect1 xml:id="migration71.incompatible">
 <title>Изменения, ломающие обратную совместимость</title>
 
 <sect2 xml:id="migration71.incompatible.too-few-arguments-exception">
  <title>Вызов исключения при передаче функции недостаточного количенства аргументов</title>
  
  <para>
   Ранее, если пользовательская функция вызывалась с недостаточным количеством 
   аргументов, выдавалось предупреждение. Теперь же, вместо предупреждения будет
   вызываться исключение класса Error. Это изменение затрагивает только пользовательские
   функции и не оказывает влияния на встроенные. Например:
  </para>
  
  <informalexample>
   <programlisting role="php">
<![CDATA[
<?php
function test($param){}
test();
]]>
   </programlisting>
   &example.outputs.similar;
   <screen>
<![CDATA[
Fatal error: Uncaught ArgumentCountError: Too few arguments to function test(), 0 passed in %s on line %d and exactly 1 expected in %s:%d
]]>
   </screen>
  </informalexample>
 </sect2>
 
 <sect2 xml:id="migration71.incompatible.forbid-dynamic-calls-to-scope-introspection-functions">
  <title>Запрет динамического вызова функций интроспекции области видимости</title>
  
  <para>
   Динамические вызовы определенных функций были запрещены (в виде
   <literal>$func()</literal> или <literal>array_map('extract', ...)</literal>, и т.д.)
   Эти функции проверяют или модифицируют объекты другой области видимости, чем
   вызывают неоднозначное и неопределенное поведение.
   Список таких функций:
  </para>
  
  <itemizedlist>
   <listitem>
    <simpara>
     <function>assert</function> - со строкой в качестве первого аргумента
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <function>compact</function>
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <function>extract</function>
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <function>func_get_args</function>
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <function>func_get_arg</function>
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <function>func_num_args</function>
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <function>get_defined_vars</function>
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <function>mb_parse_str</function> - с одним аргументом
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <function>parse_str</function> - с одним аргументом
    </simpara>
   </listitem>
  </itemizedlist>
  
  <informalexample>
   <programlisting role="php">
<![CDATA[
<?php
(function () {
    $func = 'func_num_args';
    $func();
})();
]]>
   </programlisting>
   &example.outputs;
   <screen>
<![CDATA[
Warning: Cannot call func_num_args() dynamically in %s on line %d
]]>
   </screen>
  </informalexample>
 </sect2>
 
 <sect2 xml:id="migration71.incompatible.invalid-class-names">
  <title>Некорректные имена классов, интерфейсов и трейтов</title>
  
  <para>
   Следующие имена нельзя использовать как имена классов, интерфейсов или трейтов:
  </para>
  
  <itemizedlist>
   <listitem>
    <simpara><type>void</type></simpara>
   </listitem>
   <listitem>
    <simpara><type>iterable</type></simpara>
   </listitem>
  </itemizedlist>
 </sect2>
 
 <sect2 xml:id="migration71.incompatible.numerical-strings-scientific-notation">
  <title>Преобразование числовых строк теперь учитывает научную нотацию</title>
  
  <para>
   Целочисленные операции и конвертации числовых строк теперь учитывают научную нотацию,
   включая приведение <literal>(int)</literal> и следующие функции:
   <function>intval</function> (с базой 10), <function>settype</function>,
   <function>decbin</function>, <function>decoct</function>, и <function>dechex</function>.
  </para>
 </sect2>
 
 <sect2 xml:id="migration71.incompatible.fixes-to-mt_rand-algorithm">
  <title>Исправление алгоритма <function>mt_rand</function></title>
  
  <para>
   <function>mt_rand</function> теперь по умолчанию использует зафиксированную версию
   алгоритма "Вихрь Мерсена". Если вы полагались на детерминированный вывод
   <function>mt_srand</function>, для сохранения старого (неправильного) поведения,
   можно использовать константу <constant>MT_RAND_PHP</constant> в качестве второго,
   необязательного, параметра <function>mt_srand</function>.
  </para>
 </sect2>
 
 <sect2 xml:id="migration71.incompatible.rand-srand-aliases">
  <title>
   <function>rand</function> псевдоним для <function>mt_rand</function> и
   <function>srand</function> псевдоним для <function>mt_srand</function>
  </title>
  
  <para>
   <function>rand</function> и <function>srand</function> теперь являются просто синонимами
   для <function>mt_rand</function> и <function>mt_srand</function>.
   Это означает, что вывод следующих функций изменится: <function>rand</function>,
   <function>shuffle</function>, <function>str_shuffle</function>, и 
   <function>array_rand</function>.
  </para>
 </sect2>
 
 <sect2 xml:id="migration71.incompatible.delete-control-character-in-identifiers">
  <title>Запрет использовать символ удаления из таблицы ASCII в идентификаторах</title>
  
  <para>
   Символ удаления ASCII (<literal>0x7F</literal>) больше нельзя использовать в 
   идентификаторах, не обернутых в кавычки.
  </para>
 </sect2>
 
 <sect2 xml:id="migration71.incompatible.error_log-syslog">
  <title>
   Значение <parameter>error_log</parameter> изменено на <literal>syslog</literal>
  </title>
  
  <para>
   Если ini-параметр <parameter>error_log</parameter> установлен как
   <literal>syslog</literal>, то уровни ошибок PHP проецируются на уровни ошибок "syslog".
   Это позволяет более тонко логировать события, а не как раньше, когда они все
   записывались с уровнем "notice".
  </para>
 </sect2>
 
 <sect2 xml:id="migration71.incompatible.dont-call-destructors">
  <title>Деструкторы не вызываются на незавершенных объектах</title>
  
  <para>
   Теперь деструкторы никогда не вызываются, если было вызвано исключение в
   конструкторе объекта. Раньше, это поведение зависило от того, была ли ссылка на
   объект вне конструктора (например в бэктрейсе исключения).
  </para>
 </sect2>
 
 <sect2 xml:id="migration71.incompatible.call_user_func-with-ref-args">
  <title>
   <function>call_user_func</function> обрабатывает ссылки на аргументы
  </title>
  
  <para>
   Теперь, <function>call_user_func</function> всегда вызывает предупреждение,
   если вызывается функция, ожидающая ссылки в качестве параметров. 
   Ранее это зависило от того, был ли вызов полностью определенным.
  </para>
  <para>
   Дополнительно, <function>call_user_func</function> и
   <function>call_user_func_array</function> больше не прекращают выполнение функции в
   этом случае. Предупреждение "expected reference" будет вызвано, но сама функция 
   продолжит выполнение.
  </para>
 </sect2>
 
 <sect2 xml:id="migration71.incompatible.empty-string-index-operator">
  <title>
   Оператор пустого индекса более не применим к строкам
  </title>
  
  <para>
   Применение оператора пустого индекса к строке (<literal>$str[] = $x</literal>)
   вызывает фатальную ошибку, вместо тихого преобразование переменной к массиву.
  </para>
 </sect2>
 
 <sect2 xml:id="migration71.incompatible.removed-ini-directives">
  <title>Удаленные ini-директивы</title>
  
  <para>
   Следующие ini-директивы были удалены:
  </para>
  
  <itemizedlist>
   <listitem>
    <simpara>
     <parameter>session.entropy_file</parameter>
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <parameter>session.entropy_length</parameter>
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <parameter>session.hash_function</parameter>
    </simpara>
   </listitem>
   <listitem>
    <simpara>
     <parameter>session.hash_bits_per_character</parameter>
    </simpara>
   </listitem>
  </itemizedlist>
 </sect2>
 
 <sect2 xml:id="migration71.incompatible.array-order">
  <title>
   Порядок массива, когда элементы созданы автоматически через присвоение по ссылке, был
   изменен
  </title>
  
  <para>
   Порядок расположения элементов массива, создаваемых присвоением по ссылке не созданных 
   на момент присвоения элементов, был изменен.
   К примеру:
  </para>
  
  <informalexample>
   <programlisting role="php">
<![CDATA[
<?php
$array = [];
$array["a"] =& $array["b"];
$array["b"] = 1;
var_dump($array);
?>
]]>
   </programlisting>
   &example.outputs.70;
   <screen>
<![CDATA[
array(2) {
  ["a"]=>
  &int(1)
  ["b"]=>
  &int(1)
}
]]>
   </screen>
   &example.outputs.71;
   <screen>
<![CDATA[
array(2) {
  ["b"]=>
  &int(1)
  ["a"]=>
  &int(1)
}
]]>
   </screen>
  </informalexample>
 </sect2>
 <sect2 xml:id="migration71.incompatible.sort-order">
  <title>Порядок сортировки эквивалентных элементов</title>
  <para>
   Внутренний алгоритм сортировки был улучшен, что может привести
   к отличию в порядке расположения эквивалентных элементов
   после сортировки по сравнению с предыдущими версиями PHP.
  </para>
  <note>
   <para>
    Не полагайтесь на порядок расположения эквивалентных элементов, так как
    он может в любой момент измениться.
   </para>
  </note>
 </sect2>
 <sect2 xml:id="migration71.incompatible.e-recoverable">
  <title>Сообщения для ошибок E_RECOVERABLE</title>
  <para>
   Сообщения для ошибок E_RECOVERABLE изменено с "Catchable
   fatal error" на "Recoverable fatal error".
  </para>
 </sect2>
 
 <sect2 xml:id="migration71.incompatible.datetime-microseconds">
  <title>Конструктор DateTime использует микросекунды</title>
  <para>
   Теперь <classname>DateTime</classname> и <classname>DateTimeImmutable</classname>
   используют микросекунды при инстанциировании текущим временем, либо в явном виде,
   либо со строкой относительного времени (например <literal>"first day of next
   month"</literal>). Это означает, что сравнение двух подряд созданных экземпляров
   класса скорее будет возвращать &false; нежели &true;:
   <informalexample>
    <programlisting role="php">
<![CDATA[
<?php
new DateTime() == new DateTime();
?>
]]>
    </programlisting>
   </informalexample>
  </para>
 </sect2>
 
 <sect2 xml:id="migration71.incompatible.fatal-errors-to-error-exceptions">
  <title>Fatal errors to <classname>Error</classname> exceptions conversions</title>
  <para>
   Для расширения Date, некорректные данные сериализации классов
   <classname>DateTime</classname> или <classname>DatePeriod</classname>,
   или ошибка инициализации временной зоны из сериализованных данных, будет 
   выбрасываться исключение <classname>Error</classname> из методов
   <methodname>__wakeup</methodname> или <methodname>__set_state</methodname>,
   вместо вызова фатальной ошибки.
  </para>
  
  <para>
   В расширении DBA, функции манипулирования данными (такие как
   <function>dba_insert</function>) теперь будут выбрасывать исключение
   <classname>Error</classname> вместо вызова отлавливаемой фатальной ошибки
   если ключ не содержит ровно двух элементов.
  </para>
  
  <para>
   В расширении DOM, некорректная проверка контекста схемы или RelaxNG
   теперь будут выбрасывать исключение <classname>Error</classname> вместо вызова
   фатальной ошибки. Также, попытки зарегистрировать класс узла, который не расширяет 
   правильный базовый класс, попытки прочитать некорректное свойство или перезаписать
   свойство доступное только для чтения будут выбрасывать исключение 
   <classname>Error</classname>.
  </para>
  
  <para>
   В расширение IMAP, адрес email длинее 16385 байт теперь будет выбрасывать исключение
   <classname>Error</classname> вместо вызова фатальной ошибки.
  </para>
  
  <para>
   Расширение Intl extension, при ошибке вызова родительского конструктора в классе,
   наследующем <classname>Collator</classname> до вызова родительских методов
   теперь будет выбрасывать исключение <classname>Error</classname> вместо вызова 
   фатальной ошибки. Также, клонирование объекта <classname>Transliterator</classname>
   теперь будет выбрасывать исключение <classname>Error</classname> при ошибке
   клонирования внутреннего transliterator вместо вызова фатальной ошибки.
  </para>
  
  <para>
   Расширение LDAP, при указании неизвестного типа модификации в
   <function>ldap_batch_modify</function> теперь будет выбрасывать исключение
   <classname>Error</classname> вместо вызова фатальной ошибки.
  </para>
  
  <para>
   В расширении mbstring, функции <function>mb_ereg</function> и
   <function>mb_eregi</function> теперь будут выбрасывать исключение
   <classname>ParseError</classname> в случае некорректного регулярного выражения 
   либо в случае использования опции 'e'.
  </para>
  
  <para>
   В расширении Mcrypt, <function>mcrypt_encrypt</function> и
   <function>mcrypt_decrypt</function> теперь будет выбрасывать исключение
   <classname>Error</classname> вместо вызова фатальной ошибки, если mcrypt
   не инициализирован.
  </para>
  
  <para>
   В расширении mysqli, попытки прочитать некорректное свойство или перезаписать
   свойство доступное только для чтения будут выбрасывать исключение 
   <classname>Error</classname> вместо вызова фатальной ошибки.
  </para>
  
  <para>
   В расширении Reflection, неудачное извлечение отраженного объекта или свойства объекта
   будут выбрасывать исключение 
   <classname>Error</classname> вместо вызова фатальной ошибки.
  </para>
  
  <para>
   В расширении Session, самописные обработчики сессии, которые не возвращают строку
   для идентификатора сессии будут выбрасывать исключение 
   <classname>Error</classname> вместо вызова фатальной ошибки, когда будет
   вызвана функция для генерации идентификатора.
  </para>
  
  <para>
   В расширении SimpleXML, попытка создания безымянного либо дублирующего аттрибута
   будет выбрасывать исключение 
   <classname>Error</classname> вместо вызова фатальной ошибки.
  </para>
  
  <para>
   В расширении SPL, попытка клонировать объект
   <classname>SplDirectory</classname> будет выбрасывать исключение 
   <classname>Error</classname> вместо вызова фатальной ошибки. Аналогично,
   вызов <methodname>ArrayIterator::append</methodname> когда итерация объекта
   закончена будет выбрасывать исключение 
   <classname>Error</classname>. 
  </para>
  
  <para>
   Функция <function>assert</function>, когда ей передан строковый аргумент
   первым параметром, теперь будет выбрасывать исключение 
   <classname>ParseError</classname> вместо вызова отлавливаемой фатальной ошибки,
   если PHP код некорректен. Аналогично, вызов <function>forward_static_call</function> за
   пределами пространства класса будет выбрасывать исключение 
   <classname>Error</classname>. 
  </para>
  
  <para>
   В расширении Tidy, ручное создание <classname>tidyNode</classname> будет выбрасывать 
   исключение <classname>Error</classname>. 
  </para>
  
  <para>
   В расширении WDDX, зацикленные ссылки при сериализации будут выбрасывать исключение 
   <classname>Error</classname> вместо вызова фатальной ошибки. 
  </para>
  
  <para>
   В расширении XML-RPC, зацикленные ссылки при сериализации будут выбрасывать
   исключение 
   <classname>Error</classname> вместо вызова фатальной ошибки. 
  </para>
  
  <para>
   В расширении Zip, метод <methodname>ZipArchive::addGlob</methodname>
   зацикленные ссылки при сериализации будет выбрасывать исключение 
   <classname>Error</classname> вместо вызова фатальной ошибки если отсутствует
   поддержка glob.
  </para>
 </sect2>
 
</sect1>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
