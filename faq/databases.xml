<?xml version="1.0" encoding="utf-8"?>
<!-- EN-Revision: ba08db8805ddb14cbab613c893dd47eacbda22f2 Maintainer: shein Status: ready -->
<!-- Reviewed: yes Maintainer: Alex Cooper -->
<!-- $Revision$ -->
 <chapter xml:id="faq.databases" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
  <title>Вопросы по Базам данных</title>
  <titleabbrev>Вопросы по Базам данных</titleabbrev>

  <para>
   Этот раздел содержит общие вопросы о связи между PHP и базами данных.
   Да, сегодня практически любая база данных может быть доступна из PHP.
  </para>

  <qandaset>
   <qandaentry xml:id="faq.databases.mssql">
    <question>
     <para>
      Я слышал, что можно получить доступ к Microsoft SQL серверу из PHP. Как?
     </para>
    </question>
    <answer>
     <para>
      На Windows машинах, вы просто используете поддержку ODBC и
      соответсвующий ODBC драйвер.
     </para>
     <para>
      На Unix машинах для доступа к Microsoft SQL серверам вы можете
      использовать Sybase-CT драйвер, так как они (по крайней мере в
      основном) совместимы по протоколу. У Sybase есть
      <link xlink:href="&url.sybase.ctlib;">бесплатная версия необходимых библиотек
      для Linux</link>. Для других Unix систем вам необходимо обратиться
      в Sybase за соответствующими библиотеками.
      Также смотрите ответ на следующий вопрос.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.databases.access">
    <question>
     <para>Могу ли я получить доступ к базам данных Microsoft Access?</para>
    </question>
    <answer>
     <para>
      Да. Если все полностью выполняется под Windows 9x/Me или NT/2000,
      то у вас уже есть все необходимые средства, так как для баз данных
      Microsoft Access вы можете использовать ODBC и драйверы ODBC от Microsoft.
     </para>
     <para>
      Если вы хотите связать PHP, выполняющийся на Unix, и MS Access на
      Windows, то вам будут нужны драйверы ODBC для Unix.
      Такие ODBC драйверы для Unix есть у <link xlink:href="&url.openlink;">OpenLink
      Software</link>.
     </para>
     <para>
      Другая возможность - хранить данные на SQL сервере, который имеет
      ODBC драйверы для Windows, и затем обращаться к этой базе данных из
      Microsoft Access (используя ODBC) и из PHP (используя встроенные драйверы)
      или использовать промежуточный формат понятный и для Access, и для PHP,
      например, простые файлы или базы данных dBase.
      По этому поводу Тим Хэйз (Tim Hayes) из OpenLink software пишет:
      <blockquote>
       <para>
        Использование промежуточной базы данных - не очень хорошая идея, когда
        есть возможность работать с базой данных на прямую из PHP через ODBC,
        например с драйверами от OpenLink. Если вам все-таки надо использовать
        промежуточный формат, OpenLink выпустил Virtuoso (механизм виртуальной
        базы данных) для NT, Linux и других платформ Unix.
        Пожалуйста, посетите наш <link xlink:href="&url.openlink;">вебсайт</link>
        для бесплатной загрузки.
       </para>
      </blockquote>
     </para>
     <para>
      Другой проверенный вариант - использовать MySQL с её MyODBC драйверами на
      Windows и делать синхронизацию баз данных. Стив Лоренс (Steve Lawrence)
      пишет:
     </para>
     <para>
      <itemizedlist>
       <listitem>
        <simpara>
         Установите MySQL согласно поставляемым с ней инструкциям.
         Последняя версия доступна с <link xlink:href="&url.mysql;">&url.mysql;</link>.
         Особой конфигурации не требуется,
         за исключением того, что при настройке баз данных и создании пользователя,
         в поле хоста вы должны поместить % или имя Windows машины, на которую
         вы хотите получить доступ из MySQL. Запишите имя вашего сервера,
         имя пользователя и пароль.
        </simpara>
       </listitem>
       <listitem>
        <simpara>
         Скачайте MyODBC драйвер для Windows с сайта MySQL.
         Установите его на вашей Windows машине. Вы можете проверить его
         работоспособность с помощью поставляемых с ним утилит.
        </simpara>
       </listitem>
       <listitem>
        <simpara>
         Создайте пользователя или системный dsn в вашем администраторе ODBC,
         расположенном в контрольной панели. Создайте dsn имя, введите имя хоста,
         имя пользователя, пароль и т.д. для вашей базы данных MySQL,
         сконфигурированной на 1-ом шаге.
        </simpara>
       </listitem>
       <listitem>
        <simpara>
         Установите полную версию Access, это даст вам уверенность, что вы
         получите все нужные расширения (add-ins). По крайней мере вам будут
         необходимы поддержка ODBC и администратор связанных таблиц.
        </simpara>
       </listitem>
       <listitem>
        <simpara>
         И теперь самое интересное! Создайте новую базу данных Access.
         В окне таблицы щелкните правой кнопкой мышки и выберите Link Tables
         (Связать Таблицы), либо из файлового меню выберите Get External Data
         (Получить Внешние Данные) и затем Link Tables. В появившемся окне
         просмотра файлов выберите файлы типа ODBC.
         Выберите системный dsn и имя вашего dsn, созданного на 3-ем шаге.
         Выберите таблицу для связи, нажмите OK и вуаля! Теперь вы можете
         открыть таблицу и добавить/удалить/отредактировать данные на вашем
         MySQL сервере! Вы также можете строить запросы, импортировать/экспортировать
         таблицы в MySQL, создавать формы и отчеты, и т.д.
        </simpara>
       </listitem>
      </itemizedlist>
     </para>
     <para>
      Полезные Советы и Трюки:
      <itemizedlist>
       <listitem>
        <simpara>
         Вы можете создавать ваши таблицы в Access, экспортировать их в MySQL
         и затем привязать их назад. Это увеличивает скорость создания таблиц.
        </simpara>
       </listitem>
       <listitem>
        <simpara>
         При создании таблиц в Access, вы должны определить первичный ключ,
         чтобы иметь доступ к таблице по записи. Убедитесь что вы создали
         первичный ключ в MySQL перед тем как привязать таблицу к Access.
        </simpara>
       </listitem>
       <listitem>
        <simpara>
         Если вы изменяете таблицу в MySQL, то вы должны связать её с Access
         по-новой. Идите в tools&gt;add-ins&gt;linked table manager,
         следуйте к вашему ODBC DSN, и выберите оттуда таблицу для пересвязки.
         Там же вы можете изменить источник вашего dsn, для этого, перед тем как
         нажать OK, просто пометьте "always prompt for new location"
         (всегда запрашивать новое местонахождение).
        </simpara>
       </listitem>
      </itemizedlist>
     </para>
    </answer>
   </qandaentry>
   
   <qandaentry xml:id="faq.databases.mysql.deprecated">
    <question>
     <para>
      Почему MySQL расширение (ext/mysql), которое я использовал
      более 10 лет, теперь не рекомендуется использовать? Что
      я должен использовать вместо него? Как мне обновить свои
      программы?
     </para>
    </question>
    <answer>
     <para>
      Есть три расширения для работы с MySQL, как описано в разделе
      <link linkend="mysqlinfo.api.choosing">Выбор MySQL API</link>
      Старое API не должно использоваться, и когда-нибудь будет
      помечено как устаревшее и в конце концов удалено из PHP.
      Так как это расширение очень популярно, то этот процесс будет
      долгим, но настоятельно рекомендуется писать весь новый код с
      использованием либо <link linkend="book.mysqli">mysqli</link>
      либо <link linkend="ref.pdo-mysql">PDO_MySQL</link>.
     </para>
     <para>
      Скрипты для перехода со старого API пока недоступны, но
      mysqli API содержит как процедурный так и объектный API,
      схожие со старым процедурным ext/mysql API.
     </para>
     <para>
      Нельзя совмещать различные расширения. Поэтому, например
      передача mysqli соединения в PDO_MySQL или ext/mysql не
      будет работать.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.databases.mysql.php5">
    <question>
     <para>
      Клиентские библиотеки MySQL больше не включены в PHP 5,
      как это отразится на мне? Могу ли я все так же использовать MySQL c PHP?
      Я пытаюсь работать с MySQL и получаю ошибки "function undefined" (функция
      неопределена), что выдает их?
     </para>
    </question>
    <answer>
     <para>
      Да. PHP всегда будет поддерживать MySQL в том или ином виде.
      Единственное что изменилось в PHP 5 - это то, что мы больше
      не поставляем саму клиентскую библиотеку. Вот некоторые причины для этого:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        Сегодня клиентские библиотеки уже установлены на большинстве систем.
       </para>
      </listitem>
      <listitem>
       <para>
        Учитывая предыдущий пункт, имея несколько версий, проще запутаться.
        Например, если вы компонуете mod_auth_mysql с одной версией,
        а PHP с другой, и затем разрешаете оба в Apache, то вы получите хороший
        жирный крах. Также, поставляемые библиотеки не всегда дружат с
        установленной серверной версией. Наиболее очевидный симптом этого -
        разногласие по тому где искать файл mysql.socket (файл Unix сокета).
       </para>
      </listitem>
      <listitem>
       <para>
        Также поддержка была вялой и отставала от релизов все больше и больше.
       </para>
      </listitem>
      <listitem>
       <para>
        Последующие версии библиотеки будут под GPL и мы не можем поставлять
        библиотеку под GPL с проектом лицензируемым по типу BSD/Apache.
        Поэтому полный разрыв в PHP 5 видится как самый лучший вариант.
       </para>
      </listitem>
     </itemizedlist>
     <para>
      На самом деле это заденет не так уж много людей. Пользователи Unix,
      по крайней мере те, кто знает что они делают, всегда были склонны
      собирать PHP с уже установленной на их системе библиотекой libmesqlclient,
      просто задав опцию <option role="configure">--with-mysql=/usr</option>
      при сборке. Пользователи Windows могут включить расширение
      <filename>php_mysql.dll</filename> внутри &php.ini;.
      Более подробную информацию по установке смотрите в <link linkend="ref.mysql">документации MySQL</link>.
      Также убедитесь,
      что <filename>libmysql.dll</filename> доступен в системном <envar>PATH</envar>.
      О том как - читайте FAQ: <link linkend="faq.installation.addtopath">
      установка системного PATH в Windows</link>. Так как
      <filename>libmysql.dll</filename> (и многие другие PHP файлы) находится
      в директории PHP, вам лучше добавить PHP директорию в ваш системный <envar>PATH</envar>.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.databases.shared-mysql">
    <question>
     <para>
      После установки поддержки разделения в MySQL, Apache выдает дампы сразу
      после загрузки libphp4.so. Можно ли это исправить?
     </para>
    </question>
    <answer>
     <para>
      Это происходит если вы скомпоновали ваши библиотеки MySQL с pthreads.
      Проверьте используя ldd. Если это так, скомпилируйте MySQL из исходников
      или перекомпилируйте исходный rpm, отключив поточный код клиента в
      файле спецификации. Любой из этих вариантов исправит проблему.
      Затем перекомпилируйте PHP с новыми библиотеками MySQL.
     </para>
    </answer>
   </qandaentry>

   <qandaentry xml:id="faq.databases.mysqlresource">
    <question>
     <para>
      Почему я получаю ошибки типа
      "Warning: 0 is not a MySQL result index in &lt;file&gt;
      on line &lt;x&gt;" или "Warning: Supplied argument is not
      a valid MySQL result resource in &lt;file&gt; on line &lt;x&gt;?
     </para>
    </question>
    <answer>
     <para>
      Вы пытаетесь использовать идентификатор результата, который равен 0.
      0 означает, что ваш запрос неудался по какой-либо причине. Вам необходимо
      сделать проверку на ошибки, после того как вы послали ваш запрос, и перед
      тем, как вы пытаетесь использовать возвращенный идентификатор результата.
      Правильный способ этой реализации выглядит примерно так:
      <programlisting role="php">
<![CDATA[
<?php

$result = mysql_query("SELECT * FROM tables_priv");
if (!$result) {
    echo mysql_error();
    exit;
}
?>
]]>
      </programlisting>
      или
      <programlisting role="php">
<![CDATA[
<?php

$result = mysql_query("SELECT * FROM tables_priv")
    or die("Bad query: " . mysql_error());
?>
]]>
      </programlisting>
     </para>
    </answer>
   </qandaentry>
  </qandaset>
 </chapter>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
