<?xml version="1.0" encoding="utf-8"?>
<!-- EN-Revision: 9f9375d3a4934edd8eeed98d56a180e15dcf623c Maintainer: aur Status: ready -->
<!-- Reviewed: yes Maintainer: lex -->
<!-- $Revision$ -->

<sect1 xml:id="control-structures.declare" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
 <title><literal>declare</literal></title>
 <?phpdoc print-version-for="declare"?>
 <para>
  Конструкция <literal>declare</literal> используется для установки 
  директив исполнения для блока кода. Синтаксис <literal>declare</literal>
  аналогичен с синтаксисом других конструкций управления выполнением:
  <informalexample>
   <programlisting>
<![CDATA[
declare (directive)
    statement
]]>
   </programlisting>
  </informalexample>
 </para>
 <para>
  Секция <literal>directive</literal> позволяет установить поведение 
  блока <literal>declare</literal>.
  В настоящее время распознаются только три директивы:
  директива <literal>ticks</literal> (Дополнительная информация
  о директиве <link linkend="control-structures.declare.ticks">ticks</link>
  доступна ниже), директива <literal>encoding</literal> (Дополнительная информация
  о директиве <link linkend="control-structures.declare.encoding">encoding</link>
  доступна ниже) и директива <literal>strict_types</literal> (подробности в разделе про 
  <link linkend="functions.arguments.type-declaration.strict">strict</link> на странице аргументов функции)
 </para>
 <para>
  <informaltable>
   <tgroup cols="2">
    <thead>
     <row>
      <entry>&Version;</entry>
      <entry>&Description;</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>5.3.0</entry>
      <entry>Добавлена директива <literal>encoding</literal></entry>
     </row>
     <row>
      <entry>7.0.0</entry>
      <entry>Добавлена директива <literal>strict_types</literal></entry>
     </row>
    </tbody>
  </tgroup>
  </informaltable>
 </para>
 <para>
  Поскольку директивы обрабатывается при компиляции файла, то только символьные данные
  могут использоваться как значения директивы. Нельзя использовать переменные и константы.
  Пример:
  <informalexample>
   <programlisting role="php">
<![CDATA[
<?php
// Правильно:
declare(ticks=1);

// Недопустимо:
const TICK_VALUE = 1;
declare(ticks=TICK_VALUE);
?>
]]>
   </programlisting>
  </informalexample>
 </para>
 <para>
  Часть <literal>statement</literal> блока <literal>declare</literal>
  будет выполнена - как выполняется и какие побочные эффекты
  возникают во время выполнения, может зависеть от директивы, которая установлена в
  блоке <literal>directive</literal>.
 </para>
 <para>
  Конструкция <literal>declare</literal> также может быть использована
  в глобальной области видимости, влияя на весь следующий за ней код
  (однако если файл с <literal>declare</literal> был включен, то она
  не будет действовать на родительский файл).
  <informalexample>
   <programlisting role="php">
<![CDATA[
<?php
// это то же самое:

// можно так:
declare(ticks=1) {
    // прочие действия
}

// или так:
declare(ticks=1);
// прочие действия
?>
]]>
   </programlisting>
  </informalexample>
 </para>
 
 <sect2 xml:id="control-structures.declare.ticks">
  <title>Тики</title>
  <para>Тик - это событие, которое случается каждые
   <varname>N</varname> низкоуровневых операций, выполненных
   парсером внутри блока <literal>declare</literal>.
   Значение <varname>N</varname> задается, используя
   <code>ticks=<varname>N</varname></code> внутри
   секции <literal>directive</literal> блока <literal>declare</literal>.
  </para>
  <para>
   Не все выражения подсчитываются. Обычно, условные выражения
   и выражения аргументов не подсчитываются.
  </para>
  <para>
   Событие (или несколько событий), которое возникает на каждом тике
   определяется, используя <function>register_tick_function</function>.
   Смотрите пример ниже для дополнительной информации. Имейте в виду,
   что для одного тика может возникать несколько событий.
  </para>
  <para>
   <example>
    <title>Пример использования тика</title>
    <programlisting role="php">
<![CDATA[
<?php

declare(ticks=1);

// Функция, исполняемая при каждом тике
function tick_handler()
{
    echo "Вызывается tick_handler()\n";
}

register_tick_function('tick_handler');

$a = 1;

if ($a > 0) {
    $a += 2;
    print($a);
}

?>
]]>
   </programlisting>
  </example>
  </para>
  <para>
   <example>
    <title>Пример использования тиков</title>
    <programlisting role="php">
<![CDATA[
<?php

function tick_handler()
{
  echo "Вызывается tick_handler()\n";
}

$a = 1;
tick_handler();

if ($a > 0) {
    $a += 2;
    tick_handler();
    print($a);
    tick_handler();
}
tick_handler();

?>
]]>
   </programlisting>
  </example>
  </para>
  <simpara>
   См. также <function>register_tick_function</function> и
   <function>unregister_tick_function</function>.
  </simpara>
 </sect2>
 <sect2 xml:id="control-structures.declare.encoding">
  <title>Кодировка</title>
  <para>
   Кодировка скрипта может быть указана для каждого скрипта, используя директиву <literal>encoding</literal>.
   <example>
    <title>Определение кодировки для скрипта.</title>
    <programlisting role="php">
<![CDATA[
<?php
declare(encoding='ISO-8859-1');
// прочий код
?>
]]>
   </programlisting>
   </example>
  </para>
  
  <caution>
   <simpara>
    В сочетании с пространством имен единственно допустимый синтаксис
    для declare является <literal>declare(encoding='...');</literal> где
    <literal>...</literal> это значение кодировки. <literal>declare(encoding='...') {}</literal>
    приведет к ошибке парсера, если используется вместе с пространством имен.
   </simpara>
  </caution>
  <para>
   Значение кодировки в declare игнорируется в PHP 5.3, если php не скомпилирован с
   <literal>--enable-zend-multibyte</literal>.
  </para>
  <para>
   Обратите внимание, что PHP не показывает, был ли он скомпилирован с <literal>--enable-zend-multibyte</literal>
   кроме как через <function>phpinfo</function>.
  </para>
  <para>
   Смотрите также <link linkend="ini.zend.script-encoding">zend.script_encoding</link>.
  </para>
 </sect2>
</sect1>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
