<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision$ -->
<!-- EN-Revision: 86e6094e86b84a51d00ab217ac50ce8dde33d82a Maintainer: lex Status: ready -->
<!-- Reviewed: yes Maintainer: sergey -->

<refentry xml:id="mongodb-driver-manager.construct" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
 <refnamediv>
  <refname>MongoDB\Driver\Manager::__construct</refname>
  <refpurpose>Создаёт новый Manager MongoDB</refpurpose>
 </refnamediv>
 
 <refsect1 role="description">
  &reftitle.description;
  <methodsynopsis>
   <modifier>final</modifier> <modifier>public</modifier> <methodname>MongoDB\Driver\Manager::__construct</methodname>
   <methodparam choice="opt"><type>string</type><parameter>uri</parameter><initializer>"mongodb://127.0.0.1/"</initializer></methodparam>
   <methodparam choice="opt"><type>array</type><parameter>uriOptions</parameter><initializer>array()</initializer></methodparam>
   <methodparam choice="opt"><type>array</type><parameter>driverOptions</parameter><initializer>array()</initializer></methodparam>
  </methodsynopsis>
  <para>
   Создаёт новый объект <classname>MongoDB\Driver\Manager</classname> с переданными параметрами.
  </para>
  <note>
   <simpara>
    В <link xlink:href="&url.mongodb.sdam;#single-threaded-client-construction">спецификации по обнаружению и мониторингу сервера</link>,
    этот конструктор не выполняет ввода-вывода. Соединения будут инициализироваться по требованию,
    когда выполняется первая операция.
   </simpara>
  </note>
  <note>
   <simpara>
    При передаче любых URI-опций, связанных с SSL или TLS, через строку
    подключения или параметр
    <parameter>uriOptions</parameter>, драйвер неявно включает TLS 
    при соединениях. Чтобы предотвратить это, либо явно отключите опцию
    <literal>tls</literal>, либо не передавайте никаких TLS-опций.
   </simpara>
  </note>
  &mongodb.note.forking;
 </refsect1>
 
 <refsect1 role="parameters">
  &reftitle.parameters;
  <variablelist>
   <varlistentry xml:id="mongodb-driver-manager.construct-uri">
    <term><parameter>uri</parameter></term>
    <listitem>
     <para>
      URI-адрес подключения <link xlink:href="&url.mongodb.docs;reference/connection-string/">mongodb://</link>:
      <programlisting role="txt">
<![CDATA[
mongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[defaultAuthDb][?options]]
]]>
      </programlisting>
     </para>
     <para>
      Подробнее о поддерживаемых URI параметрах, смотрите раздел
      <link xlink:href="&url.mongodb.docs;reference/connection-string/#connections-connection-options">Параметры строки подключения</link>
      в руководстве MongoDB.
      <link xlink:href="&url.mongodb.docs;reference/connection-string/#connection-pool-options">Параметры пула подключения</link>
      не поддерживаются, т.к. PHP-драйвер не реализует пулы подключений.
     </para>
     <para>
      <parameter>uri</parameter> - это URL, поэтому любые специальные символы в
      его компонентах должны закодированы в соответствии
      <link xlink:href="&url.rfc;3986">RFC 3986</link>. Это особенно
      актуально для имени пользователя и пароля, которые часто могут содержать специальные
      символы, такие как <literal>@</literal>, <literal>:</literal>, или
      <literal>%</literal>. При подключении через доменный сокет Unix, путь
      сокета может содержать специальные символы, например слеши, которые необходимо закодировать.
      Функция <function>rawurlencode</function> может использоваться для кодирования
      составных частей URI-адреса.
     </para>
     <para>
      Компонент <literal>defaultAuthDb</literal> может использоваться для указания 
      имени базы данных, связанной с учётными данными пользователя; однако 
      параметр URI <literal>authSource</literal> будет иметь приоритет, если он указан.
      Если ни <literal>defaultAuthDb</literal>, ни 
      <literal>authSource</literal> не указаны, база данных <literal>admin</literal> 
      будет использоваться по умолчанию. Компонент 
      <literal>defaultAuthDb</literal> не имеет смысла при отсутствии учётных данных пользователя.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="mongodb-driver-manager.construct-urioptions">
    <term><parameter>uriOptions</parameter></term>
    <listitem>
     <para>
      Дополнительные
      <link xlink:href="&url.mongodb.docs;reference/connection-string/#connections-connection-options">параметры строки подключения</link>,
      которые будут перезаписывать любые параметры с тем же именем в параметре 
      <parameter>uri</parameter>. 
     </para>
     <para>
      <table>
       <title>uriOptions</title>
       <tgroup cols="3">
        <thead>
         <row>
          <entry>Название опции</entry>
          <entry>Тип</entry>
          <entry>Описание</entry>
         </row>
        </thead>
        <tbody>
         <row>
          <entry>appname</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            В MongoDB 3.4+ появилась возможность добавлять аннотации к соединениям с метаданными,
            предоставляемыми подключающимся клиентом. Эти метаданные включаются в журналы
            логирования сервера при установлении соединения, а также записываются в журналы
            медленных запросов, если включено профилирование базы данных.
           </para>
           <para>
            Эта опция может использоваться для указания имени приложения, которое будет
            включено в метаданные. Значение не может превышать 128 символов.
           </para>
          </entry>
         </row>
         <row>
          <entry>authMechanism</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Механизм аутентификации, который MongoDB будет использовать для аутентификации
            соединения. Для просмотра дополнительных сведений и списка поддерживаемых
            значений, смотрите раздел
            <link xlink:href="&url.mongodb.docs;reference/connection-string/#urioption.authMechanism">Параметры аутентификации</link>
            в руководстве MongoDB.
           </para>
          </entry>
         </row>
         <row>
          <entry>authMechanismProperties</entry>
          <entry><type>array</type></entry>
          <entry>
           <para>
            Свойства для выбранного механизма аутентификации. Для просмотра дополнительных сведений и списка поддерживаемых
            значений, смотрите раздел
            <link xlink:href="&url.mongodb.specs;/blob/master/source/auth/auth.rst#auth-related-options">Спецификация аутентификации драйвера</link>.
           </para>
           <note>
            <simpara>
             Если не указана в строке URI-адреса, эта опция представляется
             в виде массива пар ключ-значение. Ключи и значения в этом массиве должны быть строками.
            </simpara>
           </note>
          </entry>
         </row>
         <row>
          <entry>authSource</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Имя базы данных, связанное с учётными данными пользователя. По умолчанию
            используется компонент базы данных из URI-адреса соединения или база данных 
            <literal>admin</literal>, если оба не указаны.
           </para>
           <para>
            Для механизмов аутентификации, которые делегируют хранение учётных данных
            другим службам (например, GSSAPI), значение должно быть
            <literal>"$external"</literal>.
           </para>
          </entry>
         </row>
         <row>
          <entry>canonicalizeHostname</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Если &true;, драйвер будет преобразовывать реальное имя хоста для
            IP-адреса сервера перед аутентификацией через SASL. Некоторые базовые
            слои GSSAPI уже делают это, но эта функциональность может быть отключена
            в их конфигурации (например, <literal>krb.conf</literal>). По умолчанию
            &false;.
           </para>
           <para>
            Этот параметр является устаревшим псевдонимом для свойства
            <literal>"CANONICALIZE_HOST_NAME"</literal> параметра URI
            <literal>"authMechanismProperties"</literal>.
           </para>
          </entry>
         </row>
         <row>
          <entry>compressors</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Имеющий приоритет, список разделённых запятыми компрессоров, 
            которые клиент хочет использовать. Сообщения сжаты только в том случае,
            если клиент и сервер совместно используют любые компрессоры,
            а компрессор, используемый в каждом направлении, 
            будет зависеть от индивидуальной конфигурации сервера или драйвера.
            Смотрите <link xlink:href="&url.mongodb.specs;/blob/master/source/compression/OP_COMPRESSED.rst#compressors">Спецификация компресии драйвера</link>
            для получения дополнительной информации.
           </para>
          </entry>
         </row>
         <row xml:id="mongodb-driver-manager.construct-urioptions.connecttimeoutms">
          <entry>connectTimeoutMS</entry>
          <entry><type>int</type></entry>
          <entry>
           <para>
            Время в миллисекунд, чтобы попытаться подключиться перед тайм-аутом.
            По умолчанию - 10 000 миллисекунд.
           </para>
          </entry>
         </row>
         <row>
          <entry>directConnection</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Этот параметр можно использовать для управления поведением обнаружения набора реплик, 
            если в строке подключения указан только один хост. По умолчанию, 
            предоставление одного члена в строке подключения приведёт к 
            установлению прямого подключения или обнаружению дополнительных членов 
            в зависимости от того, отсутствует или отсутствует опция 
            URI <literal>"replicaSet"</literal> соответственно. Укажите &false;, чтобы вызвать 
            обнаружение (если <literal>"replicaSet"</literal> опущен) 
            или укажите &true;, чтобы форсировать прямое соединение (если 
            <literal>"replicaSet"</literal> присутствует).
           </para>
          </entry>
         </row>
         <row>
          <entry>gssapiServiceName</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Устанавливает имя службы Kerberos при подключении к керберизованными
            экземплярам MongoDB. Это значение должно совпадать именем службы,
            установленным в экземплярах MongoDB (т.е. с параметром сервер,
            <link xlink:href="&url.mongodb.docs;reference/parameters/#param.saslServiceName">saslServiceName</link>
            ). По умолчанию используется <literal>"mongodb"</literal>.
           </para>
           <para>
            Этот параметр является устаревшим псевдонимом для свойства
            <literal>"SERVICE_NAME"</literal> параметра URI
            <literal>"authMechanismProperties"</literal>.
           </para>
          </entry>
         </row>
         <row>
          <entry>heartbeatFrequencyMS</entry>
          <entry><type>int</type></entry>
          <entry>
           <para>
            Задаёт интервал в миллисекундах между проверками драйвера
            топологии MongoDB, отсчитываемыми с конца предыдущей проверки 
            до начала следующей. По умолчанию - 60 000
            миллисекунд.
           </para>
           <para>
            Согласно
            <link xlink:href="&url.mongodb.sdam;#heartbeatfrequencyms">Спецификации по обнаружению и мониторингу сервера</link>,
            это значение не может быть меньше 500 миллисекунд.
           </para>
          </entry>
         </row>
         <row>
          <entry>journal</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Соответствует параметру гарантий записи <parameter>journal</parameter>.
            Если &true;, для записи будет требоваться подтверждение от
            MongoDB, что операция была записана в журнал. Подробнее
            см. <classname>MongoDB\Driver\WriteConcern</classname>.
           </para>
          </entry>
         </row>
         <row>
          <entry>localThresholdMS</entry>
          <entry><type>int</type></entry>
          <entry>
           <para>
            Размер в миллисекундах окна задержки для выбора среди
            нескольких подходящих экземпляров MongoDB при разрешении предпочтения
            чтения. По умолчанию - 15 миллисекунд.
           </para>
          </entry>
         </row>
         <row>
          <entry>maxStalenessSeconds</entry>
          <entry><type>int</type></entry>
          <entry>
           <para>
            Соответствует параметру предпочтениям чтения
            <literal>"maxStalenessSeconds"</literal>. Указывает в секундах насколько
            устаревшим может быть вторичный узел в наборе реплик, прежде чем клиент перестанет
            его использовать для операций чтения. По умолчанию не задано максимальное отставание репликации (staleness)
            и клиенты не будут учитывать отставание вторичного узла при выборе
            при выборе направления операции чтения. Подробнее см.
            <classname>MongoDB\Driver\ReadPreference</classname>.
           </para>
           <para>
            Если указана, максимальное отставание должно быть 32-битным целым числом,
            большим или равным
            <constant>MongoDB\Driver\ReadPreference::SMALLEST_MAX_STALENESS_SECONDS</constant>
            (т.е. 90 секунд).
           </para>
          </entry>
         </row>
         <row>
          <entry>password</entry>
          <entry><type>string</type></entry>
          <entry>
           Пароль для аутентификации пользователя. Эта опция полезна,
           если пароль содержит специальные символы, которые в противном случае
           должны были закодированы для URI-адреса подключения.
          </entry>
         </row>
         <row>
          <entry>readConcernLevel</entry>
          <entry><type>string</type></entry>
          <entry>
           Соответствует параметру гарантий чтения <parameter>level</parameter>
           Определяет уровень изоляции чтения. Подробнее смотрите
           <classname>MongoDB\Driver\ReadConcern</classname>.
          </entry>
         </row>
         <row>
          <entry>readPreference</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Соответствует параметру предпочтениям чтения <parameter>mode</parameter>
            По умолчанию - <literal>"primary"</literal>.
            Подробнее смотрите <classname>MongoDB\Driver\ReadPreference</classname>.
           </para>
          </entry>
         </row>
         <row>
          <entry>readPreferenceTags</entry>
          <entry><type>array</type></entry>
          <entry>
           <para>
            Соответствует параметру предпочтениям чтения <parameter>tagSets</parameter>.
            Наборы тегов позволяют настраивать операции чтения для опреденных
            членов набора реплики. Подробнее смотрите
            <classname>MongoDB\Driver\ReadPreference</classname>.
           </para>
           <note>
            <simpara>
             Если в строке URI не указано, этот параметр представляется как
             как массив, соответствующий формату, ожидаемому
             <function>MongoDB\Driver\ReadPreference::__construct</function>.
            </simpara>
           </note>
          </entry>
         </row>
         <row>
          <entry>replicaSet</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Задаёт имя набора реплики.
           </para>
          </entry>
         </row>
         <row>
          <entry>retryReads</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Указывает, должен ли драйвер автоматически повторять
            определённые операции чтения, которые не выполняются из-за временных сетевых ошибок 
            или выборов набора реплик. Требуется MongoDB 3.6+.
            По умолчанию &true;.
           </para>
           <para>
            Смотрите
            <link xlink:href="&url.mongodb.specs;/blob/master/source/retryable-reads/retryable-reads.rst">Спецификацию по Retryable Reads</link>
            для получения дополнительной информации.
           </para>
          </entry>
         </row>
         <row>
          <entry>retryWrites</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Указывает, должен ли драйвер автоматически повторять
            определённые операции записи, которые не выполняются из-за временных сетевых ошибок 
            или выборов набора реплик. Требуется MongoDB 3.6+.
            По умолчанию &true;.
           </para>
           <para>
            Смотрите
            <link xlink:href="&url.mongodb.docs;core/retryable-writes/">Retryable Writes</link>
            в руководстве MongoDB для получения дополнительной информации.
           </para>
          </entry>
         </row>
         <row>
          <entry>safe</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Если &true;, указывает <literal>1</literal> для
            параметра <parameter>w</parameter>
            гарантии записи по умолчанию. Если &false;, указывается 
            <literal>0</literal>. Подробнее смотрите
            <classname>MongoDB\Driver\WriteConcern</classname>.
           </para>
           <para>
            Эта опция устарела и не должна использоваться.
           </para>
          </entry>
         </row>
         <row xml:id="mongodb-driver-manager.construct-urioptions.serverselectiontimeoutms">
          <entry>serverSelectionTimeoutMS</entry>
          <entry><type>int</type></entry>
          <entry>
           <para>
            Указывает как долго в миллисекунд блокировать выбор сервера
            перед выбросом исключения. По умолчанию - 30 000 миллисекунд.
           </para>
          </entry>
         </row>
         <row>
          <entry>serverSelectionTryOnce</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Если &true;, то сообщает драйверу сканировать развёртывание MongoDB
            только один раз после неудачной попытки выбора сервера, а затем либо
            выбрать сервер или создать ошибку. Когда &false;, драйвер блокирует выбор и
            выполняет поиск сервера до истечения времени, указанного в параметре
            <literal>"serverSelectionTimeoutMS"</literal>. По умолчанию -
            &true;.
           </para>
          </entry>
         </row>
         <row>
          <entry>slaveOk</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Указывает <literal>"secondaryPreferred"</literal> для режима
            предпочтения чтения, если &true;. Подробности смотрите
            <classname>MongoDB\Driver\ReadPreference</classname>.
           </para>
           <para>
            Эта опция устарела и не должна использоваться.
           </para>
          </entry>
         </row>
         <row>
          <entry>socketCheckIntervalMS</entry>
          <entry><type>int</type></entry>
          <entry>
           <para>
            Если сокет не использовался в последнее время, драйвер должен проверить
            с помощью команды <literal>isMaster</literal>, прежде чем использовать
            его для любой операции. По умолчанию - 5 000 миллисекунд.
           </para>
          </entry>
         </row>
         <row>
          <entry>socketTimeoutMS</entry>
          <entry><type>int</type></entry>
          <entry>
           <para>
            Время в миллисекундах, чтобы попытаться отправить или получить в сокет
            до истечения времени. По умолчанию - 300 000 миллисекунд (т.е. 5 минут).
           </para>
          </entry>
         </row>
         <row>
          <entry>ssl</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Создаёт соединение с TLS/SSL, если &true;. По умолчанию -
            &false;.
           </para>
           <para>
            Параметр является устаревшим псевдонимом для параметра 
            URI <literal>"tls"</literal>.
           </para>
          </entry>
         </row>
         <row>
          <entry>tls</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Инициирует соединение с TLS/SSL, если &true;. 
            По умолчанию &false;.
           </para>
          </entry>
         </row>
         <row>
          <entry>tlsAllowInvalidCertificates</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Указывает, должен ли драйвер выдавать ошибку, если 
            сертификат TLS сервера недействителен. По умолчанию
            &false;.
           </para>
           <warning>
            <simpara>
             Отключение проверки сертификата создаёт уязвимость.
            </simpara>
           </warning>
          </entry>
         </row>
         <row>
          <entry>tlsAllowInvalidHostnames</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Указывает, должен ли драйвер выдавать ошибку 
            при несоответствии имени хоста сервера и имени хоста, указанного 
            в сертификате TLS. По умолчанию &false;.
           </para>
           <warning>
            <simpara>
             Отключение проверки сертификата создаёт уязвимость.
             Разрешение недопустимых имён хоста может привести к атаке типа
             <link xlink:href="&url.mongodb.wiki.mitm;">"человек посередине" (man-in-the-middle)</link>.
            </simpara>
           </warning>
          </entry>
         </row>
         <row>
          <entry>tlsCAFile</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Путь к файлу с одним или несколькими центрами сертификации, 
            которые следует считать доверенными при установлении соединения TLS.
            По умолчанию будет использоваться хранилище системных сертификатов.
           </para>
          </entry>
         </row>
         <row>
          <entry>tlsCertificateKeyFile</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Путь к файлу сертификата клиента или файлу закрытого ключа клиента;
            в случае, если они оба необходимы, файлы должны быть объединены.
           </para>
          </entry>
         </row>
         <row>
          <entry>tlsCertificateKeyFilePassword</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Пароль для расшифровки закрытого ключа клиента (т.е.
            параметра URI <literal>"tlsCertificateKeyFile"</literal>), который будет использоваться для соединений TLS.
           </para>
          </entry>
         </row>
         <row>
          <entry>tlsDisableCertificateRevocationCheck</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Если &true;, драйвер не будет пытаться проверить статус 
            отзыва сертификата (например, OCSP, CRL). По умолчанию &false;.
           </para>
          </entry>
         </row>
         <row>
          <entry>tlsDisableOCSPEndpointCheck</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Если &true;, драйвер не будет пытаться связаться с конечной 
            точкой ответа OCSP, если это необходимо (то есть ответ OCSP не сшивается). 
            По умолчанию &false;.
           </para>
          </entry>
         </row>
         <row>
          <entry>tlsInsecure</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Ослабьте ограничения TLS в максимально возможной степени.
            При значении &true; этот параметр имеет тот же эффект, что и указание значения &true; для обоих параметров URI 
            <literal>"tlsAllowInvalidCertificates"</literal>
            и
            <literal>"tlsAllowInvalidHostnames"</literal>.
            По умолчанию &false;.
           </para>
           <warning>
            <simpara>
             Отключение проверки сертификата создаёт уязвимость.
             Разрешение недопустимых имён хоста может привести к атаке типа
             <link xlink:href="&url.mongodb.wiki.mitm;">"человек посередине" (man-in-the-middle)</link>.
            </simpara>
           </warning>
          </entry>
         </row>
         <row>
          <entry>username</entry>
          <entry><type>string</type></entry>
          <entry>
           Имя пользователя для аутентификации. Эта опция полезна,
           если имя пользователя содержит специальные символы, которые в противном случае
           должны были быть закодированы в URL для URI-адреса подключения.
          </entry>
         </row>
         <row>
          <entry>w</entry>
          <entry><type class="union"><type>int</type><type>string</type></type></entry>
          <entry>
           <para>
            Соответствует параметру гарантий записи <parameter>w</parameter>.
            Подробнее смотрите
            <classname>MongoDB\Driver\WriteConcern</classname>.
           </para>
          </entry>
         </row>
         <row>
          <entry>wTimeoutMS</entry>
          <entry><type class="union"><type>int</type><type>string</type></type></entry>
          <entry>
           <para>
            Соответствует параметру гарантий записи <parameter>wtimeout</parameter>.
            Указывает срок в миллисекундах для гарантии записи. Подробнее смотрите
            <classname>MongoDB\Driver\WriteConcern</classname>.
           </para>
           <para>
            Если указан, <literal>wTimeoutMS</literal> должен быть
            32-битным целым числом со знаком, большим или равным нулю.
           </para>
          </entry>
         </row>
         <row>
          <entry>zlibCompressionLevel</entry>
          <entry><type>int</type></entry>
          <entry>
           <para>
            Указывает уровень сжатия для использования zlib. Эта
            опция ничего не делает, если <literal>zlib</literal> не включён в URL опции
            <literal>"compressors"</literal>. Смотрите 
            <link xlink:href="&url.mongodb.specs;/blob/master/source/compression/OP_COMPRESSED.rst#zlibcompressionlevel">Спецификация компрессии драйвера</link>
            для получения дополнительной информации.
           </para>
          </entry>
         </row>
        </tbody>
       </tgroup>
      </table>
     </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="mongodb-driver-manager.construct-driveroptions">
    <term><parameter>driverOptions</parameter></term>
    <listitem>
     <para>
      <table>
       <title>driverOptions</title>
       <tgroup cols="3">
        <thead>
         <row>
          <entry>Опция</entry>
          <entry>Тип</entry>
          <entry>Описание</entry>
         </row>
        </thead>
        <tbody>
         <row>
          <entry>allow_invalid_hostname</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Отключает проверку имени хоста, если &true;. По умолчанию - &false;.
           </para>
           <para>
            Разрешение недопустимых имён хоста может привести к атаке типа
            <link xlink:href="&url.mongodb.wiki.mitm;">"человек посередине" (man-in-the-middle)</link>.
           </para>
           <para>
            Этот параметр является устаревшим псевдонимом 
            для параметра URI
            <literal>"tlsAllowInvalidHostnames"</literal>
           </para>
          </entry>
         </row>
         <row>
          <entry>autoEncryption</entry>
          <entry><type>array</type></entry>
          <entry>
           <para>
            Предоставляет опции для включения автоматического шифрования на уровне поля на стороне клиента.
            Поддерживаются следующие опции:
            
            <table>
             <title>Опции для автоматического шифрования</title>
             <tgroup cols="3">
              <thead>
               <row>
                <entry>Опция</entry>
                <entry>Тип</entry>
                <entry>Описание</entry>
               </row>
              </thead>
              <tbody>
               &mongodb.option.encryption.keyVaultClient;
               &mongodb.option.encryption.keyVaultNamespace;
               &mongodb.option.encryption.kmsProviders;
               <row>
                <entry>schemaMap</entry>
                <entry><type>array</type></entry>
                <entry>
                 <para>
                  Позволяет указать локальную схему JSON, которая используется для настройки шифрования.
                 </para>
                 <note>
                  <simpara>
                   Добавление <literal>schemaMap</literal> обеспечивает большую 
                   безопасность, чем использование схем JSON, полученных с 
                   сервера. Это защищает от вредоносного сервера, рекламирующего 
                   ложную схему JSON, которая может заставить клиента отправлять 
                   незашифрованные данные, которые должны быть зашифрованы.
                  </simpara>
                 </note>
                 <note>
                  <simpara>
                   Схемы, поставляемые в <literal>schemaMap</literal>, применяются только 
                   для настройки автоматического шифрования на стороне 
                   клиента. Другие правила проверки в схеме JSON 
                   не будут применяться драйвером и приведут к ошибке.
                  </simpara>
                 </note>
                </entry>
               </row>
               <row>
                <entry>bypassAutoEncryption</entry>
                <entry><type>bool</type></entry>
                <entry>
                 Если для этого параметра установлено значение &true;, <literal>mongocryptd</literal> 
                 не будет появляться автоматически. Это используется для отключения 
                 автоматического шифрования.
                </entry>
               </row>
               <row>
                <entry>extraOptions</entry>
                <entry><type>array</type></entry>
                <entry>
                 <literal>extraOptions</literal> относится к процессу <literal>mongocryptd</literal>. Смотрите
                 <link xlink:href="&url.mongodb.specs;/blob/master/source/client-side-encryption/client-side-encryption.rst#extraoptions">Руководство по шифрованию на стороне клиента</link>,
                 чтобы получить больше информации.
                </entry>
               </row>
              </tbody>
             </tgroup>
            </table>
           </para>
           
           <note>
            <simpara>
             Автоматическое шифрование — это только корпоративная функция, которая применяется 
             только к операциям над коллекцией. Автоматическое шифрование не 
             поддерживается для операций с базой данных или представлением, операции, которые 
             не получится обойти, приведут к ошибке. Чтобы обойти автоматическое 
             шифрование для всех операций, установите <literal>bypassAutoEncryption=true</literal>
             в <literal>autoEncryption</literal>. Для получения дополнительной информации 
             об операциях в белом списке смотрите
             <link xlink:href="&url.mongodb.specs;/blob/master/source/client-side-encryption/client-side-encryption.rst#libmongocrypt-auto-encryption-whitelist">Руководство по шифрованию на стороне клиента</link>.
            </simpara>
           </note>
          </entry>
         </row>
         <row>
          <entry>ca_dir</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Путь к корректно захешированному каталогу сертификатов. По умолчанию будет
            использоваться хранилище системных сертификатов.
           </para>
          </entry>
         </row>
         <row>
          <entry>ca_file</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Путь к файлу с одним или несколькими центрами сертификации, 
            которые следует считать доверенными при установлении соединения TLS.
            По умолчанию будет
            использоваться хранилище системных сертификатов.
           </para>
           <para>
            Параметр является устаревшим псевдонимом 
            для параметра URI <literal>"tlsCAFile"</literal>.
           </para>
          </entry>
         </row>
         <row>
          <entry>context</entry>
          <entry><type>resource</type></entry>
          <entry>
           <para>
            <link linkend="context.ssl">Параметры контекста SSL</link> для использования 
            в качестве запасного варианта, если не указана опция драйвера или эквивалентная ей опция URI. Обратите внимание, что драйвер не обращается к контексту 
            потока по умолчанию (т.е. <function>stream_context_get_default</function>).
            Поддерживаются следующие параметры контекста:
           </para>
           
           <table>
            <title>Резервные параметры контекста SSL</title>
            <tgroup cols="2">
             <thead>
              <row>
               <entry>Параметр драйвера</entry>
               <entry>Параметр контекста (запасной вариант)</entry>
              </row>
             </thead>
             <tbody>
              <row>
               <entry>ca_dir</entry>
               <entry>capath</entry>
              </row>
              <row>
               <entry>ca_file</entry>
               <entry>cafile</entry>
              </row>
              <row>
               <entry>pem_file</entry>
               <entry>local_cert</entry>
              </row>
              <row>
               <entry>pem_pwd</entry>
               <entry>passphrase</entry>
              </row>
              <row>
               <entry>weak_cert_validation</entry>
               <entry>allow_self_signed</entry>
              </row>
             </tbody>
            </tgroup>
           </table>
           <para>
            Параметр поддерживается для обратной совместимости, 
            но его следует считать устаревшим.
           </para>
          </entry>
         </row>
         <row>
          <entry>crl_file</entry>
          <entry><type>string</type></entry>
          <entry>Путь к файлу списка аннулированных сертификатов.</entry>
         </row>
         <row>
          <entry>driver</entry>
          <entry><type>array</type></entry>
          <entry>
           <para>
            Позволяет пользовательским драйверам добавлять свои метаданные к рукопожатию сервера. 
            По умолчанию драйвер передаёт своё собственное имя, версию и 
            платформу (то есть версию PHP) в рукопожатие. Пользовательские драйверы могут 
            указывать строки для ключей <literal>"name"</literal>, 
            <literal>"version"</literal> и 
            <literal>"platform"</literal> этого массива, которые будут 
            добавлены к соответствующие поля в документе рукопожатия.
           </para>
           <note>
            <simpara>
             Информация о рукопожатии ограничена 512 байтами. Драйвер урезает 
             данные рукопожатия, чтобы соответствовать этой 512-байтовой строке. Драйверам и ODM 
             рекомендуется сохранять краткость своих метаданных.
            </simpara>
           </note>
          </entry>
         </row>
         <row>
          <entry>pem_file</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Путь к сертификату в формате PEM для аутентификации клиента.
           </para>
           <para>
            Этот параметр является устаревшим псевдонимом 
            для параметра URI <literal>"tlsCertificateKeyFile"</literal>.
           </para>
          </entry>
         </row>
         <row>
          <entry>pem_pwd</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Парольная фраза к PEM-закодированному сертификату (если есть).
           </para>
           <para>
            Этот параметр является устаревшим псевдонимом 
            для параметра URI <literal>"tlsCertificateKeyFilePassword"</literal>.
           </para>
          </entry>
         </row>
         <row>
          <entry>weak_cert_validation</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Отключает проверку сертифика, если &true;. По умолчанию - &false;
           </para>
           <para>
            Этот параметр является устаревшим псевдонимом 
            для параметра URI <literal>"tlsAllowInvalidHostnames"</literal>.
           </para>
          </entry>
         </row>
        </tbody>
       </tgroup>
      </table>
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </refsect1>
 
 <refsect1 role="errors">
  &reftitle.errors;
  <simplelist>
   &mongodb.throws.argumentparsing;
   <member>При неверном формате <parameter>uri</parameter> выбрасывает исключение <classname>MongoDB\Driver\Exception\RuntimeException</classname>.</member>
  </simplelist>
 </refsect1>
 
 <refsect1 role="changelog">
  &reftitle.changelog;
  <para>
   <informaltable>
    <tgroup cols="2">
     <thead>
      <row>
       <entry>&Version;</entry>
       <entry>&Description;</entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>PECL mongodb 1.8.0</entry>
       <entry>
        <para>
         Добавлены опции URI <literal>"directConnection"</literal>,
         <literal>"tlsDisableCertificateRevocationCheck"</literal>, и
         <literal>"tlsDisableOCSPEndpointCheck"</literal>.
        </para>
        <para>
         Добавлен параметр драйвера <literal>"driver"</literal>.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL mongodb 1.7.0</entry>
       <entry>
        <para>
         Добавлена опция драйвера <literal>"autoEncryption"</literal>.
        </para>
        <para>
         Указание любой опции SSL или TLS в 
         параметре <parameter>driverOptions</parameter> теперь неявно включает TLS, как это делается для 
         соответствующих опций URI.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL mongodb 1.6.0</entry>
       <entry>
        <para>
         Добавлены параметры URI <literal>"retryReads"</literal>, <literal>"tls"</literal>,
         <literal>"tlsAllowInvalidCertificates"</literal>,
         <literal>"tlsAllowInvalidHostnames"</literal>,
         <literal>"tlsCAFile"</literal>,
         <literal>"tlsCertificateKeyFile"</literal>, 
         <literal>"tlsCertificateKeyFilePassword"</literal>, и
         <literal>"tlsInsecure"</literal>.
        </para>
        <para>
         Параметр URI <literal>"retryWrites"</literal> по умолчанию &true;.
        </para>
        <para>
         Передача URI-опции SSL или TLS через строку подключения или параметр
         <parameter>uriOptions</parameter> 
         теперь неявно включает TLS, при условии, если
         <literal>ssl</literal> или
         <literal>tls</literal> не равны &false;. TSL <emphasis>не</emphasis>
         включается неявно для
         любых опций в параметре <parameter>driverOptions</parameter>,
         как в предыдущих версиях.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL mongodb 1.5.0</entry>
       <entry>
        <para>
         <literal>"wtimeoutMS"</literal> теперь всегда проверяется и применяется к
         гарантии записи. Ранее эта опция игнорировалась, если
         <literal>"w"</literal> был &lt;= 1, поскольку тайм-аут применяется только к
         репликации.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL mongodb 1.4.0</entry>
       <entry>
        <para>
         Добавлены опции URI <literal>"compressors"</literal>,
         <literal>"retryWrites"</literal> и
         <literal>"zlibCompressionLevel"</literal>.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL mongodb 1.3.0</entry>
       <entry>
        <para>
         В аргументе <parameter>uriOptions</parameter> теперь есть опции
         <literal>"authMechanism"</literal> и
         <literal>"authMechanismProperties"</literal>. Раньше эти опции
         поддерживались только в аргументе <parameter>uri</parameter>.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL mongodb 1.2.0</entry>
       <entry>
        <para>
         Аргумент <parameter>uri</parameter> по умолчанию теперь
         <literal>"mongodb://127.0.0.1/"</literal>. Порт по умолчанию не изменился -
         <literal>27017</literal>.
        </para>
        <para>
         Добавлен URI-параметр <literal>"appname"</literal>.
        </para>
        <para>
         Добавлены параметры драйвера <literal>"allow_invalid_hostname"</literal>,
         <literal>"ca_file"</literal>, <literal>"ca_dir"</literal>,
         <literal>"clr_file"</literal>, <literal>"pem_file"</literal>,
         <literal>"pem_pwd"</literal> и
         <literal>"weak_cert_validation"</literal>.
        </para>
        <para>
         API потоков PHP больше не используется для соединения с сокетом. Параметр URI
         <literal>"connectTimeoutMS"</literal> теперь по умолчанию равен 10
         секунд вместо
         <link linkend="ini.default-socket-timeout">default_socket_timeout</link>
         в предыдущих версиях. Кроме того, драйвер больше не поддерживает все
         <link linkend="context.ssl">параметры SSL-контекста</link> через параметр драйвера
         <literal>"context"</literal>.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL mongodb 1.1.0</entry>
       <entry>
        <para>
         Аргумент <parameter>uri</parameter> является необязательный и по умолчанию равен
         <literal>"mongodb://localhost:27017/"</literal>.
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </para>
 </refsect1>
 
 <refsect1 role="examples">
  &reftitle.examples;
  <example>
   <title>Примеры использования <function>MongoDB\Driver\Manager::__construct</function></title>
   <para>Подключение к автономному узлу MongoDB:</para>
   <programlisting role="php">
<![CDATA[
<?php

$manager = new MongoDB\Driver\Manager("mongodb://example.com:27017");

?>
]]>
   </programlisting>
   <para>
    Подключение к автономному узлу MongoDB через доменный сокет Unix. Путь сокета
    может содержать специальные символы, например слеши, которые должны закодированы
    с помощью <function>rawurlencode</function>.
   </para>
   <programlisting role="php">
<![CDATA[
<?php

$manager = new MongoDB\Driver\Manager("mongodb://" . rawurlencode("/tmp/mongodb-27017.sock"));

?>
]]>
   </programlisting>
   <para>Подключение к набору реплик:</para>
   <programlisting role="php">
<![CDATA[
<?php

$manager = new MongoDB\Driver\Manager("mongodb://rs1.example.com,rs2.example.com/?replicaSet=myReplicaSet");

?>
]]>
   </programlisting>
   <para>Подключение к сегментированному кластеру (т.е. одну или нескольким экземплярам mongos):</para>
   <programlisting role="php">
<![CDATA[
<?php

$manager = new MongoDB\Driver\Manager("mongodb://mongos1.example.com,mongos2.example.com/");

?>
]]>
   </programlisting>
   <para>Подключение к MongoDB с учётными данными аутентификации для конкретного пользователя и базы данных:</para>
   <programlisting role="php">
<![CDATA[
<?php

$manager = new MongoDB\Driver\Manager("mongodb://myusername:mypassword@example.com/?authSource=databaseName");

?>
]]>
   </programlisting>
   
   <para>
    Подключение к MongoDB с учётными данными аутентификации для конкретного пользователя и базы данных,
    где имя пользователя или пароль содержат специальные
    символы (например, <literal>@</literal>, <literal>:</literal>,
    <literal>%</literal>). В следующем примере, строка с паролем
    <literal>myp@ss:w%rd</literal> была вручную экранирована; однако
    <function>rawurlencode</function> может использоваться для экранирования URI-компонетов,
    которые могут содержать специальные символы.
   </para>
   <programlisting role="php">
<![CDATA[
<?php

$manager = new MongoDB\Driver\Manager("mongodb://myusername:mypassword@example.com/?authSource=databaseName");

?>
]]>
   </programlisting>
   
   <para>Подключение к MongoDB с аутентификацией X509:</para>
   <programlisting role="php">
<![CDATA[
<?php

$manager = new MongoDB\Driver\Manager(
    "mongodb://example.com/?ssl=true&authMechanism=MONGODB-X509",
    [],
    [
        "pem_file" => "/path/to/client.pem",
    ]
);
?>
]]>
   </programlisting>
  </example>
 </refsect1>
 
 <refsect1 role="seealso">
  &reftitle.seealso;
  <simplelist>
   <member><link linkend="mongodb.connection-handling">Обработка подключения и сохранение</link></member>
   <member><link xlink:href="&url.mongodb.docs;reference/connection-string/">Формат строки соединения MongoDB</link></member>
  </simplelist>
 </refsect1>
 
</refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
