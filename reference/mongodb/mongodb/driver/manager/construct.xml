<?xml version="1.0" encoding="utf-8"?>
<!-- EN-Revision: 4639881688d3faaf0073ad71fe0a4b730aea15a0 Maintainer: lex Status: ready -->
<!-- Reviewed: no -->
<refentry xml:id="mongodb-driver-manager.construct" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
 <refnamediv>
  <refname>MongoDB\Driver\Manager::__construct</refname>
  <refpurpose>Создаёт нового MongoDB-менеджера</refpurpose>
 </refnamediv>

 <refsect1 role="description">
  &reftitle.description;
  <methodsynopsis>
   <modifier>final</modifier> <modifier>public</modifier> <methodname>MongoDB\Driver\Manager::__construct</methodname>
   <methodparam choice="opt"><type class="union"><type>string</type><type>null</type></type><parameter>uri</parameter><initializer>&null;</initializer></methodparam>
   <methodparam choice="opt"><type class="union"><type>array</type><type>null</type></type><parameter>uriOptions</parameter><initializer>&null;</initializer></methodparam>
   <methodparam choice="opt"><type class="union"><type>array</type><type>null</type></type><parameter>driverOptions</parameter><initializer>&null;</initializer></methodparam>
  </methodsynopsis>
  <para>
   Метод создаёт новый объект <classname>MongoDB\Driver\Manager</classname> с заданными параметрами.
  </para>
  <note>
   <simpara>
    В <link xlink:href="&url.mongodb.sdam;#single-threaded-client-construction">спецификации по обнаружению и мониторингу сервера</link>,
    этот конструктор не выполняет ввода-вывода. Соединения будут инициализироваться по требованию,
    когда выполняется первая операция.
   </simpara>
  </note>
  <note>
   <simpara>
    При передаче любых URI-опций, которые связаны с SSL или TLS, через строку
    подключения или параметр
    <parameter>uriOptions</parameter>, модуль неявно включает TLS
    при соединениях. Чтобы предотвратить это, либо явно отключают опцию
    <literal>tls</literal>, либо не передают никаких TLS-опций.
   </simpara>
  </note>
  &mongodb.note.forking;
 </refsect1>

 <refsect1 role="parameters">
  &reftitle.parameters;
  <variablelist>
   <varlistentry xml:id="mongodb-driver-manager.construct-uri">
    <term><parameter>uri</parameter></term>
    <listitem>
     <para>
      URI-адрес подключения <link xlink:href="&url.mongodb.docs;reference/connection-string/">mongodb://</link>:
      <programlisting role="txt">
<![CDATA[
mongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[defaultAuthDb][?options]]
]]>
      </programlisting>
     </para>
     <para>
      Параметр примет значение по умолчанию <literal>"mongodb://127.0.0.1:27017"</literal>, если аргумент не передали.
     </para>
     <para>
      Подробнее о поддерживаемых URI-параметрах рассказывает раздел
      <link xlink:href="&url.mongodb.docs;reference/connection-string/#connections-connection-options">
       Параметры строки подключения
      </link>
      в руководстве MongoDB.
      <link xlink:href="&url.mongodb.docs;reference/connection-string/#connection-pool-options">
       Параметры пула подключения
      </link>
      не поддерживаются, поскольку модуль не реализует пулы подключений.
     </para>
     <para>
      <parameter>uri</parameter> — это URL, поэтому любые специальные символы в
      его компонентах должны закодированы в соответствии
      <link xlink:href="&url.rfc;3986">RFC 3986</link>. Это особенно
      актуально для имени пользователя и пароля, которые часто могут содержать специальные
      символы, такие как <literal>@</literal>, <literal>:</literal>, или
      <literal>%</literal>. При подключении через доменный сокет Unix, путь
      сокета может содержать специальные символы, например слеши, которые необходимо закодировать.
      Функция <function>rawurlencode</function> может использоваться для кодирования
      составных частей URI-адреса.
     </para>
     <para>
      Компонент <literal>defaultAuthDb</literal> может использоваться для указания
      имени базы данных, связанной с учётными данными пользователя; однако
      параметр URI <literal>authSource</literal> будет иметь приоритет, если он указан.
      Если ни <literal>defaultAuthDb</literal>, ни
      <literal>authSource</literal> не указаны, база данных <literal>admin</literal>
      будет использоваться по умолчанию. Компонент
      <literal>defaultAuthDb</literal> не имеет смысла при отсутствии учётных данных пользователя.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="mongodb-driver-manager.construct-urioptions">
    <term><parameter>uriOptions</parameter></term>
    <listitem>
     <para>
      Дополнительные
      <link xlink:href="&url.mongodb.docs;reference/connection-string/#connections-connection-options">параметры строки подключения</link>,
      которые будут перезаписывать любые параметры с тем же именем в параметре
      <parameter>uri</parameter>.
     </para>
     <para>
      <table>
       <title>uriOptions</title>
       <tgroup cols="3">
        <thead>
         <row>
          <entry>Название опции</entry>
          <entry>Тип</entry>
          <entry>Описание</entry>
         </row>
        </thead>
        <tbody>
         <row>
          <entry>appname</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            В MongoDB 3.4+ появилась возможность добавлять аннотации к соединениям с метаданными,
            предоставляемыми подключающимся клиентом. Эти метаданные включаются в журналы
            логирования сервера при установлении соединения, а также записываются в журналы
            медленных запросов, если включено профилирование базы данных.
           </para>
           <para>
            Эта опция может использоваться для указания имени приложения, которое будет
            включено в метаданные. Значение не может превышать 128 символов.
           </para>
          </entry>
         </row>
         <row>
          <entry>authMechanism</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Механизм аутентификации, который MongoDB будет использовать для аутентификации
            соединения. Для просмотра дополнительных сведений и списка поддерживаемых
            значений, смотрите раздел
            <link xlink:href="&url.mongodb.docs;reference/connection-string/#urioption.authMechanism">Параметры аутентификации</link>
            в руководстве MongoDB.
           </para>
          </entry>
         </row>
         <row>
          <entry>authMechanismProperties</entry>
          <entry><type>array</type></entry>
          <entry>
           <para>
            Свойства для выбранного механизма аутентификации. Для просмотра дополнительных сведений и списка поддерживаемых
            значений, смотрите раздел
            <link xlink:href="&url.mongodb.specs;/blob/master/source/auth/auth.rst#auth-related-options">Спецификация аутентификации драйвера</link>.
           </para>
           <note>
            <simpara>
             Если не указана в строке URI-адреса, эта опция представляется
             в виде массива пар ключ-значение. Ключи и значения в этом массиве должны быть строками.
            </simpara>
           </note>
          </entry>
         </row>
         <row>
          <entry>authSource</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Имя базы данных, связанное с учётными данными пользователя. По умолчанию
            используется компонент базы данных из URI-адреса соединения или база данных
            <literal>admin</literal>, если оба не указаны.
           </para>
           <para>
            Для механизмов аутентификации, которые делегируют хранение учётных данных
            другим службам (например, GSSAPI), значение должно быть
            <literal>"$external"</literal>.
           </para>
          </entry>
         </row>
         <row>
          <entry>compressors</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Приоритетный список разделённых запятыми компрессоров,
            которые требуется использовать клиенту. Сообщения сжаты, только если
            клиент и сервер совместно используют любые компрессоры,
            а компрессор, используемый в каждом направлении,
            будет зависеть от индивидуальной конфигурации сервера или драйвера.
            Дополнительную информацию даёт страница
            <link xlink:href="&url.mongodb.specs;/blob/master/source/compression/OP_COMPRESSED.rst#compressors">Спецификация компрессии драйвера</link>.
           </para>
          </entry>
         </row>
         <row xml:id="mongodb-driver-manager.construct-urioptions.connecttimeoutms">
          <entry>connectTimeoutMS</entry>
          <entry><type>int</type></entry>
          <entry>
           <para>
            Время ожидания в миллисекундах при попытке соединения.
            Значение по умолчанию равно 10 000 миллисекунд.
           </para>
          </entry>
         </row>
         <row>
          <entry>directConnection</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Параметр управляет поведением при обнаружении набора реплик,
            если в строке подключения указали только один хост. По умолчанию
            предоставление одного члена в строке подключения
            устанавливается прямое подключение или обнаруживается дополнительное количество членов
            в зависимости от того, указали ли
            URI-параметр <literal>"replicaSet"</literal>. Укажите &false; для принудительного
            обнаружения, если опустили параметр <literal>"replicaSet"</literal>,
            или укажите &true;, чтобы форсировать прямое соединение, если
            параметр <literal>"replicaSet"</literal> указали.
           </para>
          </entry>
         </row>
         <row>
          <entry>heartbeatFrequencyMS</entry>
          <entry><type>int</type></entry>
          <entry>
           <para>
            Задаёт интервал в миллисекундах между проверками драйвера
            топологии MongoDB, которые отсчитываются с конца предыдущей проверки
            до начала следующей. Значение по умолчанию равно 60 000
            миллисекунд.
           </para>
           <para>
            Согласно
            <link xlink:href="&url.mongodb.sdam;#heartbeatfrequencyms">Спецификации по обнаружению и мониторингу сервера</link>,
            нельзя указывать значение меньше 500 миллисекунд.
           </para>
          </entry>
         </row>
         <row>
          <entry>journal</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Соответствует параметру гарантий записи <parameter>journal</parameter>.
            Если &true;, для записи будет требоваться подтверждение от
            MongoDB, что операция была записана в журнал. Подробнее
            смотрите <classname>MongoDB\Driver\WriteConcern</classname>.
           </para>
          </entry>
         </row>
         <row>
          <entry>loadBalanced</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Указывает, подключается ли драйвер к кластеру MongoDB через балансировщик нагрузки.
            Если &true;, драйвер может подключаться только к одному узлу (указанному либо строкой подключения, либо поиском SRV),
            параметр URI <literal>"directConnection"</literal> не может быть &true; и опция URI <literal>"replicaSet"</literal> должна быть опущена. По умолчанию &false;.
           </para>
          </entry>
         </row>
         <row>
          <entry>localThresholdMS</entry>
          <entry><type>int</type></entry>
          <entry>
           <para>
            Размер в миллисекундах окна задержки для выбора среди
            нескольких подходящих экземпляров MongoDB при разрешении предпочтения
            чтения. По умолчанию — 15 миллисекунд.
           </para>
          </entry>
         </row>
         <row>
          <entry>maxStalenessSeconds</entry>
          <entry><type>int</type></entry>
          <entry>
           <para>
            Соответствует параметру предпочтения чтения
            <literal>"maxStalenessSeconds"</literal>. Указывает в секундах, насколько
            устаревшим может быть вторичный узел в наборе реплик, прежде чем клиент перестанет
            его использовать для операций чтения. По умолчанию не задано максимальное отставание репликации (staleness)
            и клиенты не будут учитывать отставание вторичного узла
            при выборе направления операции чтения. Подробнее об этом рассказано
            в описании класса <classname>MongoDB\Driver\ReadPreference</classname>.
           </para>
           <para>
            Если указана, максимальное отставание должно быть 32-битным целым числом,
            большим или равным
            <constant>MongoDB\Driver\ReadPreference::SMALLEST_MAX_STALENESS_SECONDS</constant>
            (т. е. 90 секунд).
           </para>
          </entry>
         </row>
         <row>
          <entry>password</entry>
          <entry><type>string</type></entry>
          <entry>
           Пароль для аутентификации пользователя. Эта опция полезна,
           если пароль содержит специальные символы, которые в противном случае
           должны были закодированы для URI-адреса подключения.
          </entry>
         </row>
         <row>
          <entry>readConcernLevel</entry>
          <entry><type>string</type></entry>
          <entry>
           Соответствует параметру гарантий чтения <parameter>level</parameter>
           Определяет уровень изоляции чтения. Подробнее смотрите
           <classname>MongoDB\Driver\ReadConcern</classname>.
          </entry>
         </row>
         <row>
          <entry>readPreference</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Соответствует параметру предпочтениям чтения <parameter>mode</parameter>
            По умолчанию — <literal>"primary"</literal>.
            Подробнее смотрите <classname>MongoDB\Driver\ReadPreference</classname>.
           </para>
          </entry>
         </row>
         <row>
          <entry>readPreferenceTags</entry>
          <entry><type>array</type></entry>
          <entry>
           <para>
            Соответствует параметру предпочтениям чтения <parameter>tagSets</parameter>.
            Наборы тегов позволяют настраивать операции чтения для определённых
            членов набора реплики. Подробнее смотрите
            <classname>MongoDB\Driver\ReadPreference</classname>.
           </para>
           <note>
            <simpara>
             Если в строке URI не указано, этот параметр представляется как
             как массив, соответствующий формату, ожидаемому
             <function>MongoDB\Driver\ReadPreference::__construct</function>.
            </simpara>
           </note>
          </entry>
         </row>
         <row>
          <entry>replicaSet</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Задаёт имя набора реплики.
           </para>
          </entry>
         </row>
         <row>
          <entry>retryReads</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Указывает, должен ли драйвер автоматически повторять
            определённые операции чтения, которые не выполняются из-за временных сетевых ошибок
            или выборов набора реплик. Требуется MongoDB 3.6+.
            По умолчанию &true;.
           </para>
           <para>
            Смотрите
            <link xlink:href="&url.mongodb.specs;/blob/master/source/retryable-reads/retryable-reads.rst">Спецификацию по Retryable Reads</link>
            для получения дополнительной информации.
           </para>
          </entry>
         </row>
         <row>
          <entry>retryWrites</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Указывает, должен ли драйвер автоматически повторять
            определённые операции записи, которые не выполняются из-за временных сетевых ошибок
            или выборов набора реплик. Требуется MongoDB 3.6+.
            По умолчанию &true;.
           </para>
           <para>
            Смотрите
            <link xlink:href="&url.mongodb.docs;core/retryable-writes/">Retryable Writes</link>
            в руководстве MongoDB для получения дополнительной информации.
           </para>
          </entry>
         </row>
         <row xml:id="mongodb-driver-manager.construct-urioptions.serverselectiontimeoutms">
          <entry>serverSelectionTimeoutMS</entry>
          <entry><type>int</type></entry>
          <entry>
           <para>
            Указывает как долго в миллисекунд блокировать выбор сервера
            перед выбросом исключения. По умолчанию — 30 000 миллисекунд.
           </para>
          </entry>
         </row>
         <row>
          <entry>serverSelectionTryOnce</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Со значением &true; сообщает драйверу сканировать развёртывание MongoDB
            только один раз после неудачной попытки выбора сервера, а затем
            или выбрать сервер, или создать ошибку. Со значением &false; драйвер блокирует выбор
            и выполняет поиск сервера до истечения времени, которое указали в параметре
            <literal>"serverSelectionTimeoutMS"</literal>. Значение по умолчанию
            равно &true;.
           </para>
          </entry>
         </row>
         <row>
          <entry>socketCheckIntervalMS</entry>
          <entry><type>int</type></entry>
          <entry>
           <para>
            Если сокет не использовался в последнее время, драйвер должен проверить
            с помощью команды <literal>hello</literal>, прежде чем использовать
            его для любой операции. По умолчанию — 5 000 миллисекунд.
           </para>
          </entry>
         </row>
         <row>
          <entry>socketTimeoutMS</entry>
          <entry><type>int</type></entry>
          <entry>
           <para>
            Время в миллисекундах, чтобы попытаться отправить или получить в сокет
            до истечения времени. По умолчанию — 300 000 миллисекунд (т. е. 5 минут).
           </para>
          </entry>
         </row>
         <row>
          <entry>srvMaxHosts</entry>
          <entry><type>int</type></entry>
          <entry>
           <para>
            Максимальное количество результатов SRV для случайного выбора
            при первоначальном заполнении посевного списка или, во время опроса SRV,
            при добавлении новых узлов к топологии.
            По умолчанию <literal>0</literal> (т. е. без максимума).
           </para>
          </entry>
         </row>
         <row>
          <entry>srvServiceName</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Имя службы, используемое для поиска SRV в начальном списке DNS seedlist
            обнаружения и опроса SRV. По умолчанию <literal>"mongodb"</literal>.
           </para>
          </entry>
         </row>
         <row>
          <entry>tls</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Со значением &true; инициирует соединение с TLS/SSL.
            Значение по умолчанию равно &false;.
           </para>
          </entry>
         </row>
         <row>
          <entry>tlsAllowInvalidCertificates</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Указывает драйверу, выдавать ли ошибку,
            если TLS-сертификат сервера недействителен. Значение по умолчанию
            равно &false;.
           </para>
           <warning>
            <simpara>
             Отключение проверки сертификата создаёт уязвимость.
            </simpara>
           </warning>
          </entry>
         </row>
         <row>
          <entry>tlsAllowInvalidHostnames</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Указывает, должен ли драйвер выдавать ошибку
            при несоответствии имени хоста сервера и имени хоста, указанного
            в сертификате TLS. По умолчанию &false;.
           </para>
           <warning>
            <simpara>
             Отключение проверки сертификата создаёт уязвимость.
             Разрешение недопустимых имён хоста может привести к атаке типа
             <link xlink:href="&url.mongodb.wiki.mitm;">"человек посередине" (man-in-the-middle)</link>.
            </simpara>
           </warning>
          </entry>
         </row>
         <row>
          <entry>tlsCAFile</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Путь к файлу с одним или несколькими центрами сертификации,
            которые следует считать доверенными при установлении соединения TLS.
            По умолчанию будет использоваться хранилище системных сертификатов.
           </para>
          </entry>
         </row>
         <row>
          <entry>tlsCertificateKeyFile</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Путь к файлу сертификата клиента или файлу закрытого ключа клиента;
            в случае, если они оба необходимы, файлы должны быть объединены.
           </para>
          </entry>
         </row>
         <row>
          <entry>tlsCertificateKeyFilePassword</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Пароль для расшифровки закрытого ключа клиента (т. е.
            параметра URI <literal>"tlsCertificateKeyFile"</literal>), который будет использоваться для соединений TLS.
           </para>
          </entry>
         </row>
         <row>
          <entry>tlsDisableCertificateRevocationCheck</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Если &true;, драйвер не будет пытаться проверить статус
            отзыва сертификата (например, OCSP, CRL). По умолчанию &false;.
           </para>
          </entry>
         </row>
         <row>
          <entry>tlsDisableOCSPEndpointCheck</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Если &true;, драйвер не будет пытаться связаться с конечной
            точкой ответа OCSP, если это необходимо (то есть ответ OCSP не сшивается).
            По умолчанию &false;.
           </para>
          </entry>
         </row>
         <row>
          <entry>tlsInsecure</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Ослабьте ограничения TLS в максимально возможной степени.
            При значении &true; этот параметр имеет тот же эффект, что и указание значения &true; для обоих параметров URI
            <literal>"tlsAllowInvalidCertificates"</literal>
            и
            <literal>"tlsAllowInvalidHostnames"</literal>.
            По умолчанию &false;.
           </para>
           <warning>
            <simpara>
             Отключение проверки сертификата создаёт уязвимость.
             Разрешение недопустимых имён хоста может привести к атаке типа
             <link xlink:href="&url.mongodb.wiki.mitm;">"человек посередине" (man-in-the-middle)</link>.
            </simpara>
           </warning>
          </entry>
         </row>
         <row>
          <entry>username</entry>
          <entry><type>string</type></entry>
          <entry>
           Имя пользователя для аутентификации. Эта опция полезна,
           если имя пользователя содержит специальные символы, которые в противном случае
           должны были быть закодированы в URL для URI-адреса подключения.
          </entry>
         </row>
         <row>
          <entry>w</entry>
          <entry><type class="union"><type>int</type><type>string</type></type></entry>
          <entry>
           <para>
            Соответствует параметру гарантий записи <parameter>w</parameter>.
            Подробнее смотрите
            <classname>MongoDB\Driver\WriteConcern</classname>.
           </para>
          </entry>
         </row>
         <row>
          <entry>wTimeoutMS</entry>
          <entry><type class="union"><type>int</type><type>string</type></type></entry>
          <entry>
           <para>
            Соответствует параметру гарантий записи <parameter>wtimeout</parameter>.
            Указывает срок в миллисекундах для гарантии записи. Подробнее смотрите
            <classname>MongoDB\Driver\WriteConcern</classname>.
           </para>
           <para>
            Если указан, <literal>wTimeoutMS</literal> должен быть
            32-битным целым числом со знаком, большим или равным нулю.
           </para>
          </entry>
         </row>
         <row>
          <entry>zlibCompressionLevel</entry>
          <entry><type>int</type></entry>
          <entry>
           <para>
            Указывает уровень сжатия для использования zlib. Эта
            опция ничего не делает, если <literal>zlib</literal> не включён в URL опции
            <literal>"compressors"</literal>. Смотрите
            <link xlink:href="&url.mongodb.specs;/blob/master/source/compression/OP_COMPRESSED.rst#zlibcompressionlevel">Спецификация компрессии драйвера</link>
            для получения дополнительной информации.
           </para>
          </entry>
         </row>
        </tbody>
       </tgroup>
      </table>
     </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="mongodb-driver-manager.construct-driveroptions">
    <term><parameter>driverOptions</parameter></term>
    <listitem>
     <para>
      <table>
       <title>driverOptions</title>
       <tgroup cols="3">
        <thead>
         <row>
          <entry>Опция</entry>
          <entry>Тип</entry>
          <entry>Описание</entry>
         </row>
        </thead>
        <tbody>
         <row>
          <entry>autoEncryption</entry>
          <entry><type>array</type></entry>
          <entry>
           <para>
            Предоставляет опции для включения автоматического шифрования на уровне поля на стороне клиента.
            </para>
           <note>
            <para>
             Автоматическое шифрование — функция только для Enterprise версии, которая применяется только к операциям над коллекцией.
             Автоматическое шифрование не поддерживается для операций над базой данных или представлением,
             а операции, которые не обходятся, приведут к ошибке (смотрите <link xlink:href="&url.mongodb.libmongocrypt.allow.list;">libmongocrypt: Список разрешений на автоматическое шифрование</link>). Чтобы обойти автоматическое шифрование для всех операций, установите <literal>bypassAutoEncryption</literal> в значение &true;.
            </para>
            <para>
             Автоматическое шифрование требует, чтобы у аутентифицированного пользователя была привилегия <link xlink:href="&url.mongodb.docs;reference/command/listCollections/#required-access">listCollections</link>.
            </para>
            <para>
             Явное шифрование/дешифрование и автоматическая расшифровка — это функция Community версии.
             Драйвер все ещё может автоматически расшифровывать, если у опции <literal>bypassAutoEncryption</literal> установлено значение &true;.
            </para>
           </note>
           <para>
            Поддерживаются следующие опции:

            <table>
             <title>Опции для автоматического шифрования</title>
             <tgroup cols="3">
              <thead>
               <row>
                <entry>Опция</entry>
                <entry>Тип</entry>
                <entry>Описание</entry>
               </row>
              </thead>
              <tbody>
               &mongodb.option.encryption.keyVaultClient;
               &mongodb.option.encryption.keyVaultNamespace;
               &mongodb.option.encryption.kmsProviders;
               &mongodb.option.encryption.tlsOptions;
               <row>
                <entry>schemaMap</entry>
                <entry><type class="union"><type>array</type><type>object</type></type></entry>
                <entry>
                 <para>
                  Карта пространств имён коллекции в локальную схему JSON. Используется для настройки автоматического шифрования.
                  Дополнительную информацию смотрите в <link xlink:href="&url.mongodb.docs;reference/security-client-side-automatic-json-schema/">Правилах автоматического шифрования</link> в руководстве по MongoDB.
                  Ошибкой является указание коллекции как в <literal>schemaMap</literal>, так и в <literal>encryptedFieldsMap</literal>.
                 </para>
                 <note>
                  <simpara>
                   Добавление <literal>schemaMap</literal> обеспечивает большую
                   безопасность, чем использование схем JSON, полученных с
                   сервера. Это защищает от вредоносного сервера, рекламирующего
                   ложную схему JSON, которая может заставить клиента отправлять
                   незашифрованные данные, которые должны быть зашифрованы.
                  </simpara>
                 </note>
                 <note>
                  <simpara>
                   Схемы, поставляемые в <literal>schemaMap</literal>, применяются только
                   для настройки автоматического шифрования на стороне
                   клиента. Другие правила проверки в схеме JSON
                   не будут применяться драйвером и приведут к ошибке.
                  </simpara>
                 </note>
                </entry>
               </row>
               <row>
                <entry>bypassAutoEncryption</entry>
                <entry><type>bool</type></entry>
                <entry>
                 Если &true;, <literal>mongocryptd</literal>
                 не будет появляться автоматически.
                 Используется для отключения автоматического шифрования. По умолчанию &false;.
                </entry>
               </row>
               <row>
                <entry>bypassQueryAnalysis</entry>
                <entry><type>bool</type></entry>
                <entry>
                 Если &true;, автоматический анализ исходящих команд будет отключён и <literal>mongocryptd</literal> не будет появляться автоматически.
                 Это позволяет использовать явное шифрование для запроса индексированных полей без необходимости использования лицензированной корпоративной библиотеки <literal>crypt_shared</literal> или процесса <literal>mongocryptd</literal>. По умолчанию установлено значение &false;.
                </entry>
               </row>
               <row>
                <entry>encryptedFieldsMap</entry>
                <entry><type class="union"><type>array</type><type>object</type></type></entry>
                <entry>
                 <para>
                  Карта пространств имён коллекции в документе <literal>encryptedFields</literal>. Используется для настройки шифрования с возможностью запроса. Смотрите <link xlink:href="&url.mongodb.docs;core/queryable-encryption/fundamentals/encrypt-and-query/">Шифрование полей и возможность запросов</link> в руководстве по MongoDB для получения дополнительной информации.
                  Ошибкой является указание коллекции как в <literal>encryptedFieldsMap</literal>, так и в <literal>schemaMap</literal>.
                 </para>
                 <note>
                  <simpara>
                   Указание <literal>encryptedFieldsMap</literal> обеспечивает большую безопасность, чем полагаться на <literal>encryptedFields</literal>, полученные от сервера.
                   Это защищает от злонамеренного сервера, рекламирующего ложные <literal>encryptedFields</literal>.
                  </simpara>
                 </note>
                </entry>
               </row>
               <row>
                <entry>extraOptions</entry>
                <entry><type>array</type></entry>
                <entry>
                 <para>
                  <literal>extraOptions</literal> относится к процессу <literal>mongocryptd</literal>.
                  Поддерживаются следующие параметры:
                 </para>
                 <simplelist>
                  <member>
                   <literal>mongocryptdURI</literal> (<type>string</type>): URI для подключения к существующему процессу <literal>mongocryptd</literal>.
                   По умолчанию <literal>"mongodb://localhost:27020"</literal>.
                  </member>
                  <member>
                   <literal>mongocryptdBypassSpawn</literal> (<type>bool</type>): Если &true;, предотвращает создание драйвером <literal>mongocryptd</literal>.
                   По умолчанию &false;.
                  </member>
                  <member>
                   <literal>mongocryptdSpawnPath</literal> (<type>string</type>): Абсолютный путь для поиска двоичного файла <literal>mongocryptd</literal>.
                   По умолчанию это пустая строка, использующая системные пути.
                  </member>
                  <member>
                   <literal>mongocryptdSpawnArgs</literal> (<type>array</type>): Массив строковых аргументов для передачи в <literal>mongocryptd</literal> при создании.
                   По умолчанию <literal>["--idleShutdownTimeoutSecs=60"]</literal>.
                  </member>
                  <member>
                   <literal>cryptSharedLibPath</literal> (<type>string</type>): Абсолютный путь к библиотеке общего доступа <literal>crypt_shared</literal>.
                   По умолчанию — пустая строка и использует системные пути.
                  </member>
                  <member>
                   <literal>cryptSharedLibRequired</literal> (<type>bool</type>): Если &true;, требует, чтобы драйвер загружал <literal>crypt_shared</literal>.
                   По умолчанию &false;.
                  </member>
                 </simplelist>
                 <para>
                  Смотрите
                 <link xlink:href="&url.mongodb.specs;/blob/master/source/client-side-encryption/client-side-encryption.rst#extraoptions">Руководство по шифрованию на стороне клиента</link>,
                 чтобы получить больше информации.
                 </para>
                </entry>
               </row>
              </tbody>
             </tgroup>
            </table>
           </para>

           <note>
            <simpara>
             Автоматическое шифрование — это только корпоративная функция, которая применяется
             только к операциям над коллекцией. Автоматическое шифрование не
             поддерживается для операций с базой данных или представлением, операции, которые
             не получится обойти, приведут к ошибке. Чтобы обойти автоматическое
             шифрование для всех операций, установите <literal>bypassAutoEncryption=true</literal>
             в <literal>autoEncryption</literal>. Для получения дополнительной информации
             о разрешённых операциях смотрите
             <link xlink:href="&url.mongodb.specs;/blob/master/source/client-side-encryption/client-side-encryption.rst#libmongocrypt-auto-encryption-whitelist">Руководство по шифрованию на стороне клиента</link>.
            </simpara>
           </note>
          </entry>
         </row>
         <row>
          <entry>ca_dir</entry>
          <entry><type>string</type></entry>
          <entry>
           <para>
            Путь к корректно захешированному каталогу сертификатов. По умолчанию будет
            использоваться хранилище системных сертификатов.
           </para>
          </entry>
         </row>
         <row>
          <entry>crl_file</entry>
          <entry><type>string</type></entry>
          <entry>Путь к файлу списка аннулированных сертификатов.</entry>
         </row>
         <row>
          <entry>disableClientPersistence</entry>
          <entry><type>bool</type></entry>
          <entry>
           <para>
            Со значением &true; менеджер будет использовать новый клиент библиотеки libmongoc, который не будет
            сохраняться или использоваться другими объектами Manager.
            Когда этот объект Manager освободится, его клиент уничтожится,
            а все соединения закроются. Значение по умолчанию равно &false;.
           </para>
           <note>
            <simpara>
             Отключение сохранения клиента обычно не рекомендуется.
            </simpara>
           </note>
          </entry>
         </row>
         <row>
          <entry>driver</entry>
          <entry><type>array</type></entry>
          <entry>
           <para>
            Позволяет библиотеке более высокого уровня добавлять свои метаданные
            к рукопожатию сервера. По умолчанию модуль отправляет своё имя,
            версию и платформу (то есть PHP-версию) при рукопожатии. Для ключей
            <literal>name</literal>, <literal>version</literal> и <literal>platform</literal>
            этого массива можно указать строки, которые метод добавит к полям
            документа рукопожатия.
           </para>
           <note>
            <simpara>
             Информация о рукопожатии ограничена 512 байтами. Модуль обрежет
             данные рукопожатия, чтобы соответствовать этой 512-байтовой строке. Библиотекам
             более высокого уровня рекомендуется сохранять свои метаданные краткими.
            </simpara>
           </note>
          </entry>
         </row>
         <row>
          <entry>serverApi</entry>
          <entry><classname>MongoDB\Driver\ServerApi</classname></entry>
          <entry>
           <para>
            Опция обновляет версию API-интерфейса сервера для менеджера.
            Без опции API-версия не объявляется.
           </para>
          </entry>
         </row>
        </tbody>
       </tgroup>
      </table>
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </refsect1>

 <refsect1 role="errors">
  &reftitle.errors;
  <simplelist>
   &mongodb.throws.argumentparsing;
   <member>При неверном формате <parameter>uri</parameter> выбрасывает исключение <classname>MongoDB\Driver\Exception\RuntimeException</classname>.</member>
  </simplelist>
 </refsect1>

 <refsect1 role="changelog">
  &reftitle.changelog;
  <para>
   <informaltable>
    <tgroup cols="2">
     <thead>
      <row>
       <entry>&Version;</entry>
       <entry>&Description;</entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>PECL-модуль mongodb 2.0.0</entry>
       <entry>
        <para>
         Удалили URI-параметр <literal>"canonicalizeHostname"</literal>.
         Вместо него указывают свойство URI-параметра <literal>"authMechanismProperties"</literal> —
         <literal>"CANONICALIZE_HOST_NAME"</literal>.
        </para>
        <para>
         Удалили URI-параметр <literal>"gssapiServiceName"</literal>.
         Вместо него указывают свойство URI-параметра <literal>"authMechanismProperties"</literal> —
         <literal>"SERVICE_NAME"</literal>.
        </para>
        <para>
         Удалили URI-параметр <literal>"safe"</literal> URI. Вместо него указывают
         URI-параметры <literal>"w"</literal> и <literal>"wTimeoutMS"</literal>.
        </para>
        <para>
         Удалили URI-параметр <literal>"ssl"</literal>. Вместо него указывают
         URI-параметр <literal>"tls"</literal>.
        </para>
        <para>
         Удалили драйверный параметр <literal>"allow_invalid_hostname"</literal>.
         Вместо него указывают URI-параметр <literal>"tlsAllowInvalidHostnames"</literal>.
        </para>
        <para>
         Удалили драйверный параметр <literal>"ca_file"</literal>. Вместо него указывают
         URI-параметр <literal>"tlsCAFile"</literal>.
        </para>
        <para>
         Удалили драйверный параметр <literal>"context"</literal>. Параметры
         контекста устарели в пользу URI-параметров, которые связаны
         с TLS.
        </para>
        <para>
         Удалили драйверный параметр <literal>"pem_file"</literal>. Вместо него указывают
         URI-параметр <literal>"tlsCertificateKeyFile"</literal>.
        </para>
        <para>
         Удалили драйверный параметр <literal>"pem_pwd"</literal>. Вместо него указывают
         URI-параметр <literal>"tlsCertificateKeyFilePassword"</literal>.
        </para>
        <para>
         Удалили драйверный параметр <literal>"weak_cert_validation"</literal>.
         Вместо него указывают URI-параметр <literal>"tlsAllowInvalidCertificates"</literal>.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL-модуль mongodb 1.16.0</entry>
       <entry>
        <para>
         Провайдер AWS KMS для шифрования на стороне клиента теперь принимает параметр
         <literal>"sessionToken"</literal>, который можно использовать для аутентификации
         с временными учётными данными AWS.
        </para>
        <para>
         Добавили <literal>"tlsDisableOCSPEndpointCheck"</literal> в поле
         <literal>"tlsOptions"</literal> поля
         <literal>"autoEncryption"</literal> опции драйвера.
        </para>
        <para>
         Драйвер попытается сконфигурировать провайдера, заполнив
         <link xlink:href="&url.mongodb.specs;/blob/master/source/client-side-encryption/client-side-encryption.rst#automatic-credentials">Автоматические учётные данные</link>,
         если для KMS-провайдеров <literal>"azure"</literal>
         или <literal>"gcp"</literal> указали пустой документ.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL-модуль mongodb 1.15.0</entry>
       <entry>
        <para>
         Драйвер попытается сконфигурировать провайдера, заполнив
         <link xlink:href="&url.mongodb.specs;/blob/master/source/client-side-encryption/client-side-encryption.rst#automatic-credentials">Автоматические учётные данные</link>,
         если для KMS-провайдера <literal>"aws"</literal> указали пустой документ.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL-модуль mongodb 1.14.0</entry>
       <entry>
        <para>
         Добавили опции автоматического шифрования <literal>"bypassQueryAnalysis"</literal> и <literal>"encryptedFieldsMap"</literal>.
         Дополнительные опции, относящиеся к <literal>crypt_shared</literal>, теперь поддерживаются в опции автоматического шифрования <literal>"extraOptions"</literal>.
         option.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL-модуль mongodb 1.13.0</entry>
       <entry>
        <para>
         Добавили URI-параметры <literal>"srvMaxHosts"</literal>
         и <literal>"srvServiceName"</literal>.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL-модуль mongodb 1.12.0</entry>
       <entry>
        <para>
         KMIP теперь поддерживается как KMS-провайдер для шифрования на стороне клиента
         и настраивается через поле <literal>"kmsProviders"</literal>
         параметра драйвера <literal>"autoEncryption"</literal>.
         Кроме того, параметры TLS для KMS-провайдеров теперь настраиваются в поле <literal>"tlsOptions"</literal>
         параметра драйвера <literal>"autoEncryption"</literal>.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL-модуль mongodb 1.11.0</entry>
       <entry>
        <para>
         Добавили URI-параметр <literal>"loadBalanced"</literal>.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL-модуль mongodb 1.10.0</entry>
       <entry>
        <para>
         Добавили драйверный параметр <literal>"disableClientPersistence"</literal>.
        </para>
        <para>
         Azure и GCP теперь поддерживаются как поставщик KMS
         для шифрования на стороне клиента и могут быть настроены в поле <literal>"kmsProviders"</literal> параметра драйвера <literal>"autoEncryption"</literal>.
         Строки в кодировке Base64 теперь принимаются как альтернатива <classname>MongoDB\BSON\Binary</classname>
         для параметров внутри <literal>"kmsProviders"</literal>.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL-модуль mongodb 1.8.0</entry>
       <entry>
        <para>
         Добавили URI-параметры <literal>"directConnection"</literal>,
         <literal>"tlsDisableCertificateRevocationCheck"</literal>
         и <literal>"tlsDisableOCSPEndpointCheck"</literal>.
        </para>
        <para>
         Добавили драйверный параметр <literal>"driver"</literal>.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL-модуль mongodb 1.7.0</entry>
       <entry>
        <para>
         Добавили драйверный параметр <literal>"autoEncryption"</literal>.
        </para>
        <para>
         Указание любой опции SSL или TLS
         в параметре <parameter>driverOptions</parameter> теперь неявно включает TLS, как это делается для
         соответствующих URI-параметров.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL-модуль mongodb 1.6.0</entry>
       <entry>
        <para>
         Добавили URI-параметры <literal>"retryReads"</literal>, <literal>"tls"</literal>,
         <literal>"tlsAllowInvalidCertificates"</literal>,
         <literal>"tlsAllowInvalidHostnames"</literal>,
         <literal>"tlsCAFile"</literal>,
         <literal>"tlsCertificateKeyFile"</literal>,
         <literal>"tlsCertificateKeyFilePassword"</literal>
         и <literal>"tlsInsecure"</literal>.
        </para>
        <para>
         Значение URI-параметра <literal>"retryWrites"</literal> теперь по умолчанию равно &true;.
        </para>
        <para>
         Передача URI-опции SSL или TLS через строку подключения или параметр
         <parameter>uriOptions</parameter>
         теперь неявно включает TLS, при условии,
         если значения <literal>ssl</literal>
         или <literal>tls</literal> не равны &false;. TSL <emphasis>не</emphasis>
         включается неявно
         для любых опций в параметре <parameter>driverOptions</parameter>,
         как в предыдущих версиях.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL-модуль mongodb 1.5.0</entry>
       <entry>
        <para>
         Параметр <literal>"wtimeoutMS"</literal> теперь всегда проверяется и применяется
         к гарантии записи. Раньше параметр игнорировался,
         если значение параметра <literal>"w"</literal> оказывалось &lt;= 1, поскольку время ожидания применяется только
         к репликации.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL-модуль mongodb 1.4.0</entry>
       <entry>
        <para>
         Добавили URI-параметры <literal>"compressors"</literal>,
         <literal>"retryWrites"</literal>
         и <literal>"zlibCompressionLevel"</literal>.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL-модуль mongodb 1.3.0</entry>
       <entry>
        <para>
         В аргументе <parameter>uriOptions</parameter> появились опции
         <literal>"authMechanism"</literal>
         и <literal>"authMechanismProperties"</literal>. Раньше эти опции
         поддерживались только в аргументе <parameter>uri</parameter>.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL-модуль mongodb 1.2.0</entry>
       <entry>
        <para>
         Аргумент <parameter>uri</parameter> по умолчанию теперь равен
         <literal>"mongodb://127.0.0.1/"</literal>. Порт по умолчанию не изменился —
         <literal>27017</literal>.
        </para>
        <para>
         Добавили URI-параметр <literal>"appname"</literal>.
        </para>
        <para>
         Добавили драйверные параметры <literal>"allow_invalid_hostname"</literal>,
         <literal>"ca_file"</literal>, <literal>"ca_dir"</literal>,
         <literal>"clr_file"</literal>, <literal>"pem_file"</literal>,
         <literal>"pem_pwd"</literal>
         и <literal>"weak_cert_validation"</literal>.
        </para>
        <para>
         API-интерфейс PHP-потоков больше не задействуется для соединения с сокетом. Значение URI-параметра
         <literal>connectTimeoutMS</literal> по умолчанию теперь равно 10 секундам
         вместо значения опции
         <link linkend="ini.default-socket-timeout">default_socket_timeout</link>,
         как было в предыдущих версиях. Кроме того, модуль больше не поддерживает
         <link linkend="context.ssl">параметры SSL-контекста</link> через параметр драйвера
         <literal>context</literal>.
        </para>
       </entry>
      </row>
      <row>
       <entry>PECL-модуль mongodb 1.1.0</entry>
       <entry>
        <para>
         Аргумент <parameter>uri</parameter> стал необязательным и по умолчанию равен
         <literal>"mongodb://localhost:27017/"</literal>.
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </para>
 </refsect1>

 <refsect1 role="examples">
  &reftitle.examples;
  <example>
   <title>Примеры работы метода <function>MongoDB\Driver\Manager::__construct</function></title>
   <para>Подключение к автономному узлу MongoDB:</para>
   <programlisting role="php">
<![CDATA[
<?php

$manager = new MongoDB\Driver\Manager("mongodb://example.com:27017");

?>
]]>
   </programlisting>
   <para>
    Подключение к автономному узлу СУБД MongoDB через доменный сокет Unix. Путь сокета
    допускает специальные символы наподобие слешей, которые требуется закодировать
    функцией <function>rawurlencode</function>.
   </para>
   <programlisting role="php">
<![CDATA[
<?php

$manager = new MongoDB\Driver\Manager("mongodb://" . rawurlencode("/tmp/mongodb-27017.sock"));

?>
]]>
   </programlisting>
   <para>Подключение к набору реплик:</para>
   <programlisting role="php">
<![CDATA[
<?php

$manager = new MongoDB\Driver\Manager("mongodb://rs1.example.com,rs2.example.com/?replicaSet=myReplicaSet");

?>
]]>
   </programlisting>
   <para>Подключение к сегментированному кластеру (т. е. одну или нескольким экземплярам mongos):</para>
   <programlisting role="php">
<![CDATA[
<?php

$manager = new MongoDB\Driver\Manager("mongodb://mongos1.example.com,mongos2.example.com/");

?>
]]>
   </programlisting>
   <para>Подключение к MongoDB с учётными данными аутентификации для конкретного пользователя и базы данных:</para>
   <programlisting role="php">
<![CDATA[
<?php

$manager = new MongoDB\Driver\Manager("mongodb://myusername:mypassword@example.com/?authSource=databaseName");

?>
]]>
   </programlisting>

   <para>
    Подключение к MongoDB с учётными данными аутентификации для конкретного пользователя и базы данных,
    где имя пользователя или пароль содержат специальные
    символы (например, <literal>@</literal>, <literal>:</literal>,
    <literal>%</literal>). В следующем примере, строка с паролем
    <literal>myp@ss:w%rd</literal> была вручную экранирована; однако
    <function>rawurlencode</function> может использоваться для экранирования URI-компонентов,
    которые могут содержать специальные символы.
   </para>
   <programlisting role="php">
<![CDATA[
<?php

$manager = new MongoDB\Driver\Manager("mongodb://myusername:mypassword@example.com/?authSource=databaseName");

?>
]]>
   </programlisting>

   <para>Подключение к MongoDB с аутентификацией X509:</para>
   <programlisting role="php">
<![CDATA[
<?php

$manager = new MongoDB\Driver\Manager(
    "mongodb://example.com/?ssl=true&authMechanism=MONGODB-X509",
    [],
    [
        "pem_file" => "/path/to/client.pem",
    ]
);
?>
]]>
   </programlisting>
  </example>
 </refsect1>

 <refsect1 role="seealso">
  &reftitle.seealso;
  <simplelist>
   <member><link linkend="mongodb.connection-handling">Обработка подключения и сохранение</link></member>
   <member><link xlink:href="&url.mongodb.docs;reference/connection-string/">Формат строки соединения MongoDB</link></member>
  </simplelist>
 </refsect1>

</refentry>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
